<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>FreeFlow ‚Äî zam√≥w g≈Çosem</title>
  <meta name="theme-color" content="#0b0f14">
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0f14; --text:#eef3fb; --muted:#a6b2c3; --glass:rgba(0,0,0,.35);
      --stroke:rgba(255,255,255,.08); --ring:rgba(0,214,255,.35); --brand:#ff7a00
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--text);
      background:var(--bg) url("assets/Background.png") center/cover fixed no-repeat;
      font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial
    }

    /* === top === */
    .topbar{
      position:sticky;top:0;z-index:50;
      background:linear-gradient(to bottom,rgba(11,15,20,.95),rgba(11,15,20,.55),transparent);
      padding:14px 16px 8px
    }
    .top{
      max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:12px
    }
    .brand{flex:1 1 auto}
    .row{display:flex;gap:6px;align-items:baseline}
    .free{color:var(--brand);font:700 26px/1 Poppins}
    .flow{font:700 26px/1 Poppins}
    .sub{color:var(--muted);font-size:12px;margin-top:4px}
    .actions{display:flex;gap:10px}
    .action{
      display:inline-flex;align-items:center;gap:10px;min-width:44px;justify-content:center;
      height:44px;padding:0 14px;border-radius:14px;background:var(--glass);border:1px solid var(--stroke)
    }
    .badge{display:inline-grid;place-items:center;width:26px;height:26px;border-radius:9px;background:#ff9f2e;font-weight:700}

    /* === grid g≈Ç√≥wny === */
    .wrap{max-width:1100px;margin:0 auto;padding:0 16px 98px}
    h1{font:700 clamp(28px,7vw,44px)/1.1 Poppins;margin:12px 0 4px}
    .lead{color:var(--muted);margin:0 0 14px}

    .logo-wrap{display:grid;place-items:center;margin:6px 0 10px}
    .logo-btn{position:relative;border:0;background:transparent;border-radius:22px;outline:0}
    #ffLogo{
      width:min(88vw,620px);height:auto;display:block;border-radius:22px;will-change:transform,filter;
      transition:transform .18s ease, filter .18s ease
    }
    /* PULS ca≈Çego bƒÖbla przy nas≈Çuchu */
    .logo-btn.listening #ffLogo{
      animation:ffpulse 1.15s ease-in-out infinite
    }
    @keyframes ffpulse{
      0%{transform:scale(1);filter:drop-shadow(0 0 0 rgba(0,214,255,0))}
      50%{transform:scale(1.03);filter:drop-shadow(0 0 14px rgba(0,214,255,.45)) drop-shadow(0 0 22px rgba(255,122,0,.25))}
      100%{transform:scale(1);filter:drop-shadow(0 0 0 rgba(0,214,255,0))}
    }

    .bubble{
      background:var(--glass);border:1px solid var(--stroke);border-radius:16px;
      padding:14px 16px;font-size:18px
    }

    .cards{display:grid;gap:14px;margin-top:12px}
    .card{background:var(--glass);border:1px solid var(--stroke);border-radius:16px;padding:14px 16px}
    .card h3{margin:0 0 8px;font:600 18px/1.2 Poppins}
    .card ul{margin:0;padding-left:18px;color:var(--muted)}

    /* === DOCK (kafelki) na dole === */
    .dock{
      position:fixed;left:12px;right:12px;bottom:12px;z-index:60;
      display:flex;gap:12px;justify-content:center;background:var(--glass);
      border:1px solid var(--stroke);border-radius:18px;padding:10px;backdrop-filter:blur(4px)
    }
    .pill{
      flex:1 1 0%;min-width:0;text-align:center;cursor:pointer;padding:12px 14px;
      border-radius:14px;font-size:16px;background:rgba(255,255,255,.04);border:1px solid var(--stroke);
      outline:2px solid transparent
    }
    .pill.active{outline:2px solid var(--ring);box-shadow:0 0 0 6px rgba(0,214,255,.08) inset}

    .toast{position:fixed;left:14px;right:14px;bottom:80px;z-index:70;
      background:var(--glass);border:1px solid var(--stroke);border-radius:16px;padding:14px 16px}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="top">
      <div class="brand">
        <div class="row"><span class="free">Free</span><span class="flow">Flow</span></div>
        <div class="sub">Voice to order ‚Äî tryb testowy, bez profilowania</div>
      </div>
      <div class="actions">
        <button class="action" aria-label="Menu">‚â°</button>
        <button class="action" aria-label="Koszyk"><span>üõí</span><span class="badge" id="cartNum">11</span></button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <h1>Z≈Ç√≥≈º zam√≥wienie</h1>
    <p class="lead">Jedzenie, Taxi albo nocleg ‚Äî powiedz lub kliknij.</p>

    <section class="logo-wrap">
      <button id="micBtn" class="logo-btn" aria-label="Naci≈õnij i m√≥w">
        <img id="ffLogo" src="assets/Freeflowlogo.png?v=12" alt="FreeFlow logo">
      </button>
    </section>

    <!-- transkrypcja POD bƒÖblem -->
    <div id="transcript" class="bubble">Powiedz, co chcesz zam√≥wiƒá‚Ä¶</div>

    <!-- feed kart / odpowiedzi -->
    <section id="cardFeed" class="cards"></section>
  </main>

  <!-- Dock z kafelkami na dole -->
  <nav class="dock" id="dock">
    <button class="pill" data-cat="food">üçΩÔ∏è Jedzenie</button>
    <button class="pill" data-cat="taxi">üöï Taxi</button>
    <button class="pill" data-cat="hotel">üè° Hotel</button>
  </nav>

  <div id="toast" class="toast" hidden></div>

  <script>
    // ===== helpers UI =====
    const $ = s => document.querySelector(s);
    const $$ = s => [...document.querySelectorAll(s)];
    const toastEl = $("#toast");
    function toast(msg, ms=2400){
      toastEl.textContent = msg; toastEl.hidden = false;
      clearTimeout(toast._t); toast._t = setTimeout(()=>toastEl.hidden=true, ms);
    }

    const transEl = $("#transcript");
    const cardFeed = $("#cardFeed");
    const micBtn = $("#micBtn");
    const pills = $$(".pill");

    function card(title, lines){
      const el = document.createElement("article");
      el.className = "card";
      el.innerHTML = `<h3>${title}</h3><ul>${(lines||[]).map(li=>`<li>${li}</li>`).join("")}</ul>`;
      cardFeed.prepend(el);
    }

    // ===== kafelki (presety) =====
    const presets={
      food:"Zam√≥w capriciosƒô na wiecz√≥r do Demo Partner.",
      taxi:"Zam√≥w taks√≥wkƒô na 20:00 do Katowic.",
      hotel:"Zarezerwuj pok√≥j dla dw√≥ch os√≥b w centrum Katowic."
    };
    function setActive(cat){pills.forEach(p=>p.classList.toggle("active", p.dataset.cat===cat));}
    pills.forEach(p=>p.addEventListener("click", ()=>{
      const cat = p.dataset.cat; setActive(cat);
      const q = presets[cat] || "Z≈Ç√≥≈º zam√≥wienie.";
      transEl.textContent = q;
      handleOrder(q);
    }));
    setActive("food");

    // ===== mikrofon =====
    function speechSupported(){return "webkitSpeechRecognition" in window || "SpeechRecognition" in window;}
    let rec=null;
    function startRec(){
      if(!speechSupported()){ toast("Mikrofon dzia≈Ça w Chrome/Edge (Web Speech API)."); return; }
      try{
        const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
        rec = new SR(); rec.lang="pl-PL"; rec.continuous=false; rec.interimResults=true;
        micBtn.classList.add("listening");
        transEl.textContent="‚è∫Ô∏è S≈Çucham‚Ä¶";
        let final="";
        rec.onresult=(e)=>{
          let interim=""; for(let i=e.resultIndex;i<e.results.length;i++){
            const t=e.results[i][0].transcript;
            e.results[i].isFinal ? final+=t+" " : interim+=t;
          }
          transEl.textContent=(final+interim).trim();
        };
        rec.onerror=()=>{ micBtn.classList.remove("listening"); toast("B≈ÇƒÖd mikrofonu / uprawnienia."); };
        rec.onend=()=>{ micBtn.classList.remove("listening");
          const q = transEl.textContent.replace(/^‚è∫Ô∏è S≈Çucham‚Ä¶?$/,'').trim();
          if(q) handleOrder(q);
        };
        rec.start();
      }catch(e){ micBtn.classList.remove("listening"); toast("B≈ÇƒÖd Web Speech: "+e.message); }
    }
    micBtn.addEventListener("click", startRec);

    // ===== order: backend + cichy mock =====
    async function handleOrder(query){
      const MOCK={title:"Propozycja (demo)",lines:["‚úÖ Status: gotowe","üè¨ Miejsce: Demo Partner","‚è±Ô∏è Czas: 15‚Äì20 min","üíµ Cena: PLN 38","‚ÑπÔ∏è Info: wersja testowa (mock)."]};
      try{
        const res = await fetch("https://ffend-vercel.vercel.app/api/order?query="+encodeURIComponent(query), {mode:"cors"});
        if(!res.ok) throw new Error("HTTP "+res.status);
        const data = await res.json();
        if(data && data.title && Array.isArray(data.lines)) card(data.title,data.lines);
        else card(MOCK.title,MOCK.lines);
      }catch{ card(MOCK.title,MOCK.lines); }
    }

    // init
    card("Witaj w FreeFlow",["Kliknij kafelek na dole albo naci≈õnij logo, by m√≥wiƒá."]);
  </script>
</body>
</html>
