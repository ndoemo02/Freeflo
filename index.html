<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0d1117" />
  <title>FreeFlow — Voice to order</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#131922;
      --panel-2:#10161e;
      --text:#e8e8ea;
      --text-dim:#b8c0cc;
      --brand:#ff7a1a;
      --brand-2:#ffb56b;
      --ok:#00d084;
      --ring:rgba(255,122,26,.35);
      --ring-2:rgba(0,208,132,.35);
      --stroke:rgba(255,255,255,.07);
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:radial-gradient(80% 60% at 50% 0%, #111826 0%, #0b0f14 60%, #090c10 100%); color:var(--text); font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;}
    a{color:var(--brand)}
    .wrap{max-width:1100px; margin:0 auto; padding:20px 16px 80px}

    /* header */
    .topbar{display:flex;align-items:center;gap:14px}
    .brand{font-size:36px;font-weight:800;letter-spacing:.5px}
    .brand .a{color:var(--brand)}
    .sub{color:var(--text-dim);font-size:14px;margin-left:6px}
    .spacer{flex:1}
    .iconbtn{position:relative; display:inline-grid; place-items:center; width:52px;height:52px;border-radius:14px;border:1px solid var(--stroke); background:linear-gradient(180deg,#151b25,#0f141c); box-shadow: inset 0 0 30px rgba(255,255,255,.02);}
    .iconbtn svg{width:26px;height:26px;opacity:.9}
    .badge{position:absolute;top:-6px;right:-6px;background:var(--brand);color:#000;font-weight:800;border-radius:999px;padding:3px 7px;font-size:12px;box-shadow:0 6px 18px rgba(255,122,26,.5)}

    h1{font-size:48px;line-height:1.05;margin:22px 0 8px}
    .lead{color:var(--text-dim);font-size:20px;margin:0 0 10px}

    /* VOICE button (logo = whole button) */
    .voice-cta{display:flex;justify-content:center;align-items:center;margin:8px 0 12px}
    #voiceBtn{position:relative;background:none;border:0;padding:0;border-radius:9999px;cursor:pointer;outline-offset:12px}
    #voiceBtn img{width:min(75vw,560px);height:auto;display:block;border-radius:50%;pointer-events:none;filter:drop-shadow(0 28px 60px rgba(0,0,0,.55))}
    #voiceBtn::before{content:"";position:absolute;inset:-12%;border-radius:50%;
      background: radial-gradient(60% 60% at 50% 50%, rgba(255,122,26,.18), rgba(255,122,26,.06) 55%, transparent 70%);
      z-index:-1; filter:blur(14px);}
    .ring{position:absolute;inset:-4%;border-radius:50%;border:2px dashed var(--ring);opacity:.65;animation:idleRing 3.2s ease-in-out infinite;pointer-events:none}
    @keyframes idleRing{0%{transform:rotate(0deg) scale(1)} 50%{transform:rotate(180deg) scale(1.02)} 100%{transform:rotate(360deg) scale(1)}}
    .pulse{position:absolute;inset:-6%;border-radius:50%;border:2px solid rgba(255,140,0,.45);
      pointer-events:none;animation:idlePulse 2.4s ease-in-out infinite;opacity:.9;box-shadow:0 0 22px rgba(255,140,0,.18)}
    @keyframes idlePulse{from{transform:scale(1);opacity:.65} 50%{transform:scale(1.025);opacity:1} to{transform:scale(1);opacity:.65}}

    #voiceHint{position:absolute;left:50%;bottom:6.5%;transform:translateX(-50%);
      background:rgba(20,20,28,.65);backdrop-filter:blur(8px);padding:.62rem .95rem;border-radius:14px;
      font-size:1rem;color:#e6e6e6;pointer-events:none;border:1px solid rgba(255,255,255,.06);
      box-shadow:0 10px 30px rgba(0,0,0,.35)}

    /* when recording */
    .recording #voiceBtn .pulse{border-color:var(--ok);box-shadow:0 0 24px var(--ring-2), inset 0 0 36px rgba(0,208,132,.25); animation:recPulse 1.1s ease-out infinite}
    @keyframes recPulse{0%{transform:scale(1);opacity:1} 100%{transform:scale(1.08);opacity:.6}}
    .recording #voiceHint{color:#dfffe8;border-color:rgba(0,208,132,.4);background:rgba(6,34,24,.6)}
    .recording #voiceBtn::before{background: radial-gradient(60% 60% at 50% 50%, rgba(0,208,132,.20), rgba(0,208,132,.08) 55%, transparent 70%);}

    /* transcript */
    .transcript{margin:16px auto 14px;max-width:880px;padding:16px 18px;border-radius:18px;
      background:linear-gradient(180deg,rgba(18,20,24,.75),rgba(12,14,18,.72));
      color:var(--text);border:1px solid var(--stroke);box-shadow:0 10px 30px rgba(0,0,0,.35); font-size:18px}
    .transcript .interim{opacity:.55}
    .dot{display:inline-block;width:10px;height:10px;border-radius:50%; background:#25d366;box-shadow:0 0 14px rgba(37,211,102,.5);margin-right:10px;vertical-align:-1px}
    .recording .dot{background:var(--ok);box-shadow:0 0 14px rgba(0,208,132,.7)}

    /* quick actions */
    .quickbar{display:flex;gap:14px;flex-wrap:wrap;justify-content:center;margin-top:10px}
    .pill{display:flex;align-items:center;gap:10px;border:1px solid var(--stroke);background:linear-gradient(180deg,#141a23,#0f141c);padding:14px 18px;border-radius:16px}
    .pill svg{width:20px;height:20px;color:var(--brand-2)}

    /* menu drawer */
    .drawer-back{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(2px);display:none}
    .drawer{position:fixed;top:0;left:0;height:100%;width:84%;max-width:360px;background:var(--panel-2);
      border-right:1px solid var(--stroke);box-shadow: 0 20px 60px rgba(0,0,0,.6); transform:translateX(-100%); transition:.28s ease}
    .drawer.open{transform:translateX(0)}
    .drawer-back.show{display:block}
    .menu-head{display:flex;align-items:center;gap:10px;padding:18px;border-bottom:1px solid var(--stroke);font-weight:700}
    .menu-body{padding:10px 18px 24px}
    .menu-item{padding:12px 10px;border-radius:10px}
    .menu-item:hover{background:#0f131a}

    @media (max-width:500px){
      h1{font-size:40px}
      .brand{font-size:30px}
      #voiceBtn img{width:min(86vw,540px)}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Top bar -->
    <div class="topbar">
      <div class="brand"><span class="a">Free</span>Flow</div>
      <div class="sub">Voice to order</div>
      <div class="spacer"></div>
      <button class="iconbtn" id="menuBtn" aria-label="Menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
      <button class="iconbtn" aria-label="Koszyk">
        <span class="badge" id="cartBadge">0</span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6 6h15l-2 9H8L6 6Z"/><circle cx="9" cy="20" r="1.8"/><circle cx="18" cy="20" r="1.8"/>
        </svg>
      </button>
    </div>

    <h1>Złóż zamówienie</h1>
    <p class="lead">Taxi, posiłek, a może nocleg?</p>

    <!-- Voice button (logo) -->
    <div class="voice-cta">
      <button id="voiceBtn" aria-label="Mów teraz">
        <img src="./Freeflow-logo.png" alt="FreeFlow — naciśnij, aby mówić" />
        <span class="ring" aria-hidden="true"></span>
        <span class="pulse" aria-hidden="true"></span>
        <span id="voiceHint">Dotknij logo i mów…</span>
      </button>
    </div>

    <!-- Transcript -->
    <div id="transcript" class="transcript" aria-live="polite">
      <span class="dot"></span> Transkrypcja pojawi się tutaj…
    </div>

    <!-- Quick actions -->
    <div class="quickbar">
      <div class="pill"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7h16M6 7v12m12-12v12M4 19h16"/></svg> Jedzenie</div>
      <div class="pill"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 16l2-5h14l2 5H3Z"/><path d="M7 16v3m10-3v3"/></svg> Taxi</div>
      <div class="pill"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 10l9-6 9 6v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z"/><path d="M9 22V12h6v10"/></svg> Hotel</div>
    </div>
  </div>

  <!-- Drawer -->
  <div class="drawer-back" id="drawerBack"></div>
  <nav class="drawer" id="drawer" aria-hidden="true">
    <div class="menu-head">FreeFlow — menu</div>
    <div class="menu-body">
      <div class="menu-item">Twoje zamówienia</div>
      <div class="menu-item">Ustawienia</div>
      <div class="menu-item">Pomoc</div>
      <div class="menu-item">O projekcie</div>
    </div>
  </nav>

  <script>
    // --- menu drawer ---
    const menuBtn = document.getElementById('menuBtn');
    const drawer = document.getElementById('drawer');
    const drawerBack = document.getElementById('drawerBack');
    function openDrawer(){ drawer.classList.add('open'); drawerBack.classList.add('show'); drawer.setAttribute('aria-hidden','false'); }
    function closeDrawer(){ drawer.classList.remove('open'); drawerBack.classList.remove('show'); drawer.setAttribute('aria-hidden','true'); }
    menuBtn.addEventListener('click', openDrawer);
    drawerBack.addEventListener('click', closeDrawer);

    // --- Voice logic (robust for Android/Chrome/Edge) ---
    (() => {
      const voiceBtn = document.getElementById('voiceBtn');
      const voiceHint = document.getElementById('voiceHint');
      const transcriptEl = document.getElementById('transcript');

      let recognition = null;
      let isRecording = false;

      function setupRecognition() {
        const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SR) {
          voiceHint.textContent = 'Brak wsparcia rozpoznawania mowy w tej przeglądarce.';
          return null;
        }
        const r = new SR();
        r.lang = 'pl-PL';
        r.interimResults = true;
        r.continuous = false;

        r.onstart = () => {
          isRecording = true;
          document.body.classList.add('recording');
          voiceHint.textContent = 'Słucham… mów';
        };
        r.onend = () => {
          isRecording = false;
          document.body.classList.remove('recording');
          voiceHint.textContent = 'Dotknij logo i mów…';
        };
        r.onresult = (e) => {
          let interim = '', final = '';
          for (let i = e.resultIndex; i < e.results.length; i++) {
            const t = e.results[i][0].transcript;
            if (e.results[i].isFinal) final += t + ' ';
            else interim += t;
          }
          transcriptEl.innerHTML = '<span class="dot"></span> ' + final + '<span class="interim">' + interim + '</span>';
        };
        r.onerror = (e) => {
          let msg = 'Błąd: ' + e.error;
          if (e.error === 'not-allowed') msg = 'Dostęp do mikrofonu zablokowany – odblokuj w uprawnieniach przeglądarki.';
          if (e.error === 'no-speech') msg = 'Nie wykryto mowy. Spróbuj mówić głośniej lub bliżej mikrofonu.';
          voiceHint.textContent = msg;
        };
        return r;
      }

      async function ensureMicPermission() {
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return true;
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          stream.getTracks().forEach(t => t.stop());
          return true;
        } catch (err) {
          voiceHint.textContent = (err.name === 'NotAllowedError')
            ? 'Dostęp do mikrofonu zablokowany – zezwól w ustawieniach strony.'
            : 'Nie mogę użyć mikrofonu: ' + err.name;
          return false;
        }
      }

      async function toggleRecord() {
        if (!recognition) {
          recognition = setupRecognition();
          if (!recognition) return;
        }
        if (isRecording) {
          try { recognition.stop(); } catch(_) {}
          return;
        }
        const ok = await ensureMicPermission();
        if (!ok) return;

        try { recognition.start(); }
        catch (e) {
          // sporadyczny "already started" — restart
          try { recognition.stop(); } catch(_) {}
          setTimeout(() => { try { recognition.start(); } catch(_) {} }, 220);
        }
      }

      // pełne pokrycie zdarzeń (tap/click/klawiatura)
      ['click','touchend','pointerup','keydown'].forEach(type => {
        voiceBtn.addEventListener(type, (ev) => {
          if (type === 'keydown' && !['Enter',' '].includes(ev.key)) return;
          ev.preventDefault();
          toggleRecord();
        }, { passive: false });
      });
    })();
  </script>
</body>
</html>
