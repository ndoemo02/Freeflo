<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FreeFlow ‚Äì Voice to Order</title>
<style>
  :root{
    --bg:#0b0f14; --bg2:#111720; --text:#e9e9e9; --muted:#b8c0cc;
    --brand:#ff7a1a; --brand2:#ff9a3c; --chip:#1a2230;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:linear-gradient(180deg,#0b0f14 0%, #0d141e 100%);
    color:var(--text); font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
    min-height:100vh; display:flex; flex-direction:column;
  }
  header{padding:28px 22px 6px}
  .logoTitle{
    font-weight:800; font-size:36px; letter-spacing:.5px; color:var(--brand);
  }
  .subtitle{color:var(--text); opacity:.9; font-size:22px; margin-top:6px}
  .card{
    margin:18px; padding:16px; background:var(--bg2);
    border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px #1b2430;
  }
  .chips{display:flex; flex-wrap:wrap; gap:10px; margin:2px 0 8px}
  .chip{
    font-size:14px; padding:10px 12px; border-radius:14px; color:#d8dee9;
    background:var(--chip); border:1px solid #1f2a3a;
  }
  .pane{margin-top:8px; padding:14px; border-radius:14px; background:#0f1622; border:1px solid #1d2736}
  .pane.muted{color:var(--muted)}
  .pane.good{background:rgba(255,122,26,.08); border-color:rgba(255,122,26,.35)}
  .hint{color:#8fa3bf; font-size:14px; margin:12px 18px 110px}
  /* FAB with logo */
  .fabWrap{
    position:fixed; left:50%; bottom:22px; transform:translateX(-50%);
    width:min(86vw,360px); display:flex; justify-content:center;
  }
  .fab{
    position:relative; width:200px; height:200px; border-radius:50%;
    border:none; background:#0e1520; cursor:pointer; outline:none;
    box-shadow:0 20px 40px rgba(0,0,0,.55), inset 0 0 0 1px #1b2430;
    display:grid; place-items:center;
  }
  .fab.glow{box-shadow:0 0 0 0 rgba(255,122,26,.55), 0 16px 40px rgba(0,0,0,.55);
            animation:glow 1.6s ease-in-out infinite}
  @keyframes glow{
    0%{box-shadow:0 0 0 0 rgba(255,122,26,.55), 0 16px 40px rgba(0,0,0,.55)}
    60%{box-shadow:0 0 60px 26px rgba(255,122,26,.18), 0 16px 40px rgba(0,0,0,.55)}
    100%{box-shadow:0 0 0 0 rgba(255,122,26,.0), 0 16px 40px rgba(0,0,0,.55)}
  }
  .fab img{width:88%; height:88%; object-fit:contain; border-radius:50%}
  .sr{position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(0 0 0 0)}
</style>
</head>
<body>

<header>
  <div class="logoTitle">FreeFlow</div>
  <div class="subtitle">Z≈Ç√≥≈º zam√≥wienie</div>
</header>

<section class="card">
  <div class="chips">
    <div class="chip">‚Äûdwie pizze pepperoni‚Äù</div>
    <div class="chip">‚Äûzam√≥w taxi na Dworzec‚Äù</div>
    <div class="chip">‚Äûhotel w Krakowie na 2 noce‚Äù</div>
  </div>

  <div id="heard" class="pane muted">üéôÔ∏è Jeszcze nic nie nagrano.</div>
  <div id="reply" class="pane good">üîä Witaj! Kliknij mikrofon na dole i powiedz, czego potrzebujesz.</div>
</section>

<p class="hint">Podpowied≈∫: m√≥w wyra≈∫nie. W ha≈Çasie te≈º zadzia≈Ça, ale mo≈ºe potrzebowaƒá powt√≥rki.</p>

<div class="fabWrap">
  <button id="micBtn" class="fab" aria-pressed="false">
    <span class="sr">Przycisk mikrofonu</span>
    <!-- U≈ºyj w≈Çasnego pliku logo.png w repo -->
    <img src="./logo.png" alt="FreeFlow ‚Äì mikrofon" />
  </button>
</div>

<script>
  // --- Web Speech ‚Äì rozpoznawanie mowy ---
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const synth = window.speechSynthesis;

  const micBtn = document.getElementById('micBtn');
  const heard  = document.getElementById('heard');
  const reply  = document.getElementById('reply');

  let rec = null, listening = false;

  function speak(text){
    try{
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'pl-PL';
      u.rate = 1.0; u.pitch = 1.0;
      synth.cancel(); synth.speak(u);
    }catch(e){}
  }

  function handleIntent(text){
    const t = text.toLowerCase();

    // proste regu≈Çy demo (fallback)
    if(/cze≈õƒá|hej|dzie≈Ñ dobry/.test(t)) return "Cze≈õƒá! Co dla Ciebie zrobiƒá?";
    if(/anuluj|stop/.test(t)) return "Jasne, anulowa≈Çem.";
    if(/pepperoni|peperoni/.test(t) && /pizza|pizz[e|y]?/.test(t)){
      const qty = /dwie|2/.test(t) ? 2 : /trzy|3/.test(t) ? 3 : 1;
      return `Zapisujƒô: ${qty}√ó pizza pepperoni. Potwierdzasz?`;
    }
    if(/taxi/.test(t)) return "OK, taxi. SkƒÖd dokƒÖd jedziemy?";
    if(/hotel|nocleg/.test(t)) return "Jasne ‚Äì kt√≥ry kierunek i na ile nocy?";
    return "Zrozumia≈Çem. Chcesz zam√≥wiƒá jedzenie, taxi czy nocleg?";
  }

  function startRec(){
    if(!SpeechRecognition){ reply.textContent="Twoja przeglƒÖdarka nie obs≈Çuguje rozpoznawania mowy."; return; }
    if(rec){ try{ rec.stop(); }catch(e){} }
    rec = new SpeechRecognition();
    rec.lang = 'pl-PL';
    rec.interimResults = true;
    rec.maxAlternatives = 1;

    rec.onstart = ()=>{
      listening = true;
      micBtn.classList.add('glow');
      micBtn.setAttribute('aria-pressed','true');
      reply.textContent = "üîä S≈Çucham‚Ä¶ powiedz swoje zam√≥wienie.";
    };
    rec.onerror = (e)=>{
      listening = false;
      micBtn.classList.remove('glow');
      micBtn.setAttribute('aria-pressed','false');
      reply.textContent = "Ups. B≈ÇƒÖd mikrofonu: " + (e.error||'');
    };
    rec.onend = ()=>{
      listening = false;
      micBtn.classList.remove('glow');
      micBtn.setAttribute('aria-pressed','false');
    };
    rec.onresult = (ev)=>{
      let finalText='';
      for(let i=ev.resultIndex;i<ev.results.length;i++){
        const r = ev.results[i], tx = r[0].transcript;
        if(r.isFinal) finalText += tx + ' ';
        else heard.textContent = 'üéôÔ∏è ' + tx;
      }
      finalText = finalText.trim();
      if(finalText){
        heard.textContent = 'üó£Ô∏è ' + finalText;
        const ans = handleIntent(finalText);
        reply.textContent = 'üîä ' + ans;
        speak(ans);
      }
    };
    rec.start();
  }

  micBtn.addEventListener('click', ()=>{
    if(listening){ try{ rec.stop(); }catch(e){} return; }
    startRec();
  });

  // iOS/Android: pierwszy klik w≈ÇƒÖcza TTS
  document.body.addEventListener('touchstart', ()=>{}, {passive:true});
</script>
</body>
</html>
