<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Free Flow ‚Äî zam√≥w g≈Çosem</title>
  <meta name="theme-color" content="#0b0f14"/>

  <style>
    :root{
      --bg:#0b0f14;
      --glass:rgba(12,16,22,.55);
      --glass2:rgba(12,16,22,.38);
      --stroke:rgba(255,255,255,.08);
      --text:#e9eef6;
      --muted:#a8b3c7;
      --brand:#ff7a00;
      --ok:#35d07f;
      --warn:#ffb020;
      --err:#ff5d5d;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:#0b0f14 url("assets/bg.jpg") center/cover fixed no-repeat;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    a{color:inherit}
    .wrap{max-width:1080px;margin:0 auto;padding:18px 16px 94px}
    .row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}

    /* header */
    .brand{display:flex;align-items:center;gap:10px}
    .brand .dot{color:var(--brand);font-weight:800;font-size:34px;line-height:1}
    .brand .name{font-size:34px;font-weight:800}
    .sub{color:var(--muted);margin-top:-6px}

    .actions{margin-left:auto;display:flex;gap:10px}
    .iconBtn{
      border:1px solid var(--stroke); background:var(--glass2);
      width:52px;height:52px;border-radius:16px;display:grid;place-items:center;
      backdrop-filter: blur(10px); -webkit-tap-highlight-color:transparent; outline:none;
    }
    .iconBtn:active{transform:scale(.98)}
    .cartBadge{position:absolute;margin-top:-26px;margin-left:30px;background:#ff8c1a;
      color:#111;padding:2px 8px;border-radius:12px;font-weight:700}

    /* titles */
    h1{font-size:44px;line-height:1.08;margin:18px 0 6px}
    .lead{color:var(--muted);font-size:20px;margin:0 0 16px}

    /* hero logo */
    .hero{display:grid;place-items:center;margin:8px 0 10px}
    .logo-wrap{position:relative;width:min(78vw,460px);aspect-ratio:1/1;display:grid;place-items:center}
    .logo-wrap object{width:100%;height:100%;pointer-events:none;outline:none}
    .logo-hit{
      position:absolute;inset:0;border-radius:28px;cursor:pointer;background:transparent;
      -webkit-tap-highlight-color:transparent; outline:none;border:none;
    }
    /* mic glow while listening */
    .glow{animation:glow 1.2s ease-in-out infinite}
    @keyframes glow{
      0%{filter:drop-shadow(0 0 0px rgba(0,191,255,.0))}
      50%{filter:drop-shadow(0 0 14px rgba(0,191,255,.45))}
      100%{filter:drop-shadow(0 0 0px rgba(0,191,255,.0))}
    }

    /* transcript */
    .bubble{
      margin:8px auto 10px;max-width:900px;min-height:56px;
      background:var(--glass);border:1px solid var(--stroke);border-radius:16px;
      padding:14px 16px;font-size:20px;display:flex;align-items:center;gap:10px;
      backdrop-filter: blur(10px);
    }
    .bubble .dot{width:10px;height:10px;border-radius:50%;background:var(--muted)}
    .bubble.listening .dot{background:#45caff;box-shadow:0 0 10px #45caff}

    /* tiles */
    .tiles{position:fixed;left:0;right:0;bottom:14px;display:flex;gap:14px;
      justify-content:center;padding:0 16px;pointer-events:none}
    .tile{
      pointer-events:auto;flex:0 1 31%;min-width:140px;max-width:300px;
      background:var(--glass);border:1px solid var(--stroke);border-radius:22px;
      padding:14px 18px; display:flex;align-items:center;gap:12px;
      backdrop-filter: blur(10px);
    }
    .tile .label{font-size:20px}
    .tile .em{font-size:24px}
    .tile.active{outline:2px solid rgba(69,202,255,.45)}
    .tile.blink{animation:blink .7s ease 1}
    @keyframes blink{0%,100%{outline-color:transparent}50%{outline:2px solid rgba(255,255,255,.35)}}

    /* toast summary */
    .toast{
      position:fixed;left:16px;right:16px;bottom:118px;max-width:980px;margin:auto;
      background:var(--glass); border:1px solid var(--stroke); border-radius:18px;
      padding:16px 16px 12px; backdrop-filter:blur(10px); display:none;
    }
    .toast.show{display:block;animation:fade .18s ease}
    @keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
    .toast h3{margin:0 0 10px;font-size:22px}
    .li{display:flex;gap:10px;align-items:center;margin:6px 2px}
    .li .ico{width:26px;text-align:center}
    .toast .closeX{position:absolute;right:12px;top:10px;cursor:pointer;color:#ddd}

    /* drawer menu */
    .scrim{position:fixed;inset:0;background:rgba(0,0,0,.35);backdrop-filter:blur(1px);display:none}
    .scrim.on{display:block}
    .drawer{
      position:fixed;top:0;right:-340px;width:320px;max-width:85vw;height:100%;
      background:rgba(14,18,24,.9);border-left:1px solid var(--stroke);
      box-shadow:-20px 0 60px rgba(0,0,0,.35);transition:right .18s ease; padding:16px;
    }
    .drawer.on{right:0}
    .menu h4{margin:6px 0 10px;font-size:18px;color:#dbe7ff}
    .menu .item{
      border:1px solid var(--stroke);background:var(--glass2);border-radius:12px;
      padding:12px 12px;margin:8px 0;cursor:pointer;display:flex;justify-content:space-between;align-items:center;
    }
    .menu details{border:1px solid var(--stroke);border-radius:12px;background:var(--glass2);margin:8px 0}
    .menu summary{list-style:none;padding:12px;cursor:pointer}
    .menu summary::-webkit-details-marker{display:none}
    .menu .sub{padding:0 10px 10px}
    .pill{background:#19202a;border:1px solid var(--stroke);padding:2px 8px;border-radius:999px;color:#b9c7dd;font-size:12px}

    @media (max-width:520px){
      h1{font-size:36px}
      .lead{font-size:18px}
      .logo-wrap{width:min(82vw,430px)}
      .tiles{gap:10px}
      .tile{padding:12px 14px;border-radius:18px}
      .tile .label{font-size:18px}
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- HEADER -->
    <div class="row">
      <div class="brand">
        <div class="dot">Free</div><div class="name">Flow</div>
      </div>
      <div class="actions">
        <button id="menuBtn" class="iconBtn" aria-label="Menu">‚ò∞</button>
        <div style="position:relative">
          <button class="iconBtn" aria-label="Koszyk">üõí</button>
          <div class="cartBadge">11</div>
        </div>
      </div>
      <div class="sub" style="flex-basis:100%">Voice to order ‚Äî tryb testowy, bez profilowania</div>
    </div>

    <!-- TITLES -->
    <h1>Z≈Ç√≥≈º zam√≥wienie</h1>
    <p class="lead">Jedzenie, Taxi albo nocleg ‚Äî powiedz lub kliknij.</p>

    <!-- HERO LOGO -->
    <section class="hero">
      <div class="logo-wrap" id="logoWrap">
        <object id="logoSvg" type="image/svg+xml" data="assets/freeflow-logo.svg"></object>
        <button id="logoBtn" class="logo-hit" aria-label="Naci≈õnij aby m√≥wiƒá"></button>
      </div>
    </section>

    <!-- TOAST PODSUMOWANIA (wyskakuje nad transkrypcjƒÖ) -->
    <div id="toast" class="toast" role="status" aria-live="polite">
      <span class="closeX" id="toastClose">‚úï</span>
      <h3>Podsumowanie</h3>
      <div id="toastItems"></div>
    </div>

    <!-- TRANSKRYPCJA -->
    <div id="transcript" class="bubble" aria-live="polite"><span class="dot"></span><span id="txt">Powiedz, co chcesz zam√≥wiƒá‚Ä¶</span></div>

  </div><!-- /wrap -->

  <!-- DOLNE KAFELKI -->
  <div class="tiles">
    <button id="tileFood"  class="tile"><span class="em">üçΩÔ∏è</span><span class="label" style="color:#fff">Jedzenie</span></button>
    <button id="tileTaxi"  class="tile"><span class="em">üöï</span><span class="label" style="color:#fff">Taxi</span></button>
    <button id="tileHotel" class="tile"><span class="em">üè†</span><span class="label" style="color:#fff">Hotel</span></button>
  </div>

  <!-- DRAWER MENU -->
  <div id="scrim" class="scrim"></div>
  <aside id="drawer" class="drawer">
    <div class="menu">
      <h4>Menu</h4>

      <details>
        <summary>üí≥ P≈Çatno≈õci <span class="pill">demo</span></summary>
        <div class="sub">
          <div class="item" data-pay="card">Karta (Visa/Mastercard) <span>‚Ä∫</span></div>
          <div class="item" data-pay="blik">BLIK <span>‚Ä∫</span></div>
          <div class="item" data-pay="paypal">PayPal <span>‚Ä∫</span></div>
        </div>
      </details>

      <div class="item" id="ordersBtn">üßæ Moje zam√≥wienia <span>‚Ä∫</span></div>
      <div class="item" id="faqBtn">‚ùì FAQ <span>‚Ä∫</span></div>
    </div>
  </aside>

  <script>
  // ---------- helpers ----------
  const $ = sel => document.querySelector(sel);
  const logoBtn = $('#logoBtn'), logoWrap = $('#logoWrap'), logoSvg = $('#logoSvg');
  const txtEl = $('#txt'), transcript = $('#transcript');
  const tileFood = $('#tileFood'), tileTaxi = $('#tileTaxi'), tileHotel = $('#tileHotel');
  const toast = $('#toast'), toastItems = $('#toastItems'), toastClose = $('#toastClose');
  const drawer = $('#drawer'), scrim = $('#scrim'), menuBtn = $('#menuBtn');

  function setTxt(s){ txtEl.textContent = s || ''; }
  function showToast(items){
    toastItems.innerHTML = items.map(it => `
      <div class="li"><div class="ico">${it.icon}</div><div>${it.text}</div></div>
    `).join('');
    toast.classList.add('show');
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=>toast.classList.remove('show'), 6000);
  }
  toastClose.onclick = ()=> toast.classList.remove('show');

  function openDrawer(open=true){ drawer.classList.toggle('on', open); scrim.classList.toggle('on', open);}
  scrim.onclick = ()=>openDrawer(false);
  menuBtn.onclick = ()=>openDrawer(true);

  // P≈Çatno≈õci / Moje zam√≥wienia / FAQ (mock)
  drawer.addEventListener('click', (e)=>{
    const it = e.target.closest('.item'); if(!it) return;
    if(it.dataset.pay){
      const map = {card:'Karta', blik:'BLIK', paypal:'PayPal'};
      showToast([{icon:'üí≥',text:`Wybrano p≈Çatno≈õƒá: ${map[it.dataset.pay]} (demo)`},
                 {icon:'‚ÑπÔ∏è',text:'To tylko makieta ‚Äî bez obciƒÖ≈ºenia.'}]);
      openDrawer(false);
    }
  });
  $('#ordersBtn').onclick = ()=>{
    showToast([
      {icon:'üßæ',text:'Zam√≥wienie #A1 ‚Äì ‚Äû2x pepperoni‚Äù, 18:00, status: potwierdzone'},
      {icon:'üßæ',text:'Zam√≥wienie #A0 ‚Äì ‚ÄûTaxi ‚Üí Centrum‚Äù, 10 min, status: zrealizowane'},
    ]);
    openDrawer(false);
  };
  $('#faqBtn').onclick = ()=>{
    showToast([
      {icon:'‚ùì',text:'Jak to dzia≈Ça? Powiedz co chcesz: ‚Äûdwie pepperoni na 18:00‚Äù.'},
      {icon:'üó£Ô∏è',text:'Rozpoznawanie dzia≈Ça w Chrome/Edge. iOS Safari ‚Üí ‚ÄûDodaj do ekranu g≈Ç√≥wnego‚Äù.'}
    ]);
    openDrawer(false);
  };

  // ---------- STT engine ----------
  let recognition=null, isListening=false, finalOnly='';

  function squashRepeats(s){
    s = s.replace(/\b(\w+)(?:\s+\1){1,5}\b/gi, '$1');
    s = s.replace(/\b(\w+\s+\w+)(?:\s+\1){1,5}\b/gi, '$1');
    return s;
  }
  function clean(s){
    if(!s) return '';
    s = s.replace(/(\d{1,2})\s*;\s*(\d{2})/g,'$1:$2');
    return squashRepeats(s).replace(/\s+/g,' ').trim();
  }
  function timeOf(t){
    const m = clean(t).match(/\b([01]?\d|2[0-3])[:\.]([0-5]\d)\b/);
    if(m) return `${m[1].padStart(2,'0')}:${m[2]}`;
    const m2 = clean(t).match(/\bna\s+(\d{1,2})\b/); // ‚Äûna 18‚Äù
    if(m2) return `${m2[1].padStart(2,'0')}:00`;
    return null;
  }
  function quantityOf(t){
    const num = t.match(/\b(\d{1,2})\b/); if(num) return parseInt(num[1],10);
    const map = { 'jeden':1,'jednƒÖ':1,'jedna':1,'jedno':1,'dwie':2,'dwa':2,'trzy':3,'cztery':4,'piƒôƒá':5,'sze≈õƒá':6,'siedem':7,'osiem':8,'dziewiƒôƒá':9,'dziesiƒôƒá':10 };
    for(const k of Object.keys(map)){ if(new RegExp(`\\b${k}\\b`,'i').test(t)) return map[k]; }
    return null;
  }
  function dishOf(t){
    // bardzo prosta heurystyka
    t = t.toLowerCase();
    const dishes = ['pepperoni','margherita','capricciosa','hawajska','kebab','burger','sushi','ramen'];
    for(const d of dishes){ if(t.includes(d)) return d; }
    // po ‚Äûna‚Äù/‚Äûdla‚Äù zostaw s≈Çowa jako ‚Äûdanie‚Äù
    return null;
  }
  function placeOf(t){
    const m = t.match(/\bdo\s+([A-ZƒÑƒÜƒò≈Å≈É√ì≈ö≈π≈ª][\w-ƒÖƒáƒô≈Ç≈Ñ√≥≈õ≈∫≈º]+)/i) || t.match(/\bna\s+([A-ZƒÑƒÜƒò≈Å≈É√ì≈ö≈π≈ª][\w-ƒÖƒáƒô≈Ç≈Ñ√≥≈õ≈∫≈º]+)/i);
    return m ? m[1] : null;
  }
  function category(t){
    t=t.toLowerCase();
    if(/taxi|taks|przejazd|dojazd|podw√≥z|podwie≈∫/.test(t)) return 'taxi';
    if(/hotel|nocleg|pok√≥j|rezerwuj/.test(t)) return 'hotel';
    return 'food';
  }

  function addMicGlow(on){
    logoWrap.classList.toggle('glow', !!on);
    transcript.classList.toggle('listening', !!on);
  }

  function blinkTile(cat){
    const map = {food:tileFood,taxi:tileTaxi,hotel:tileHotel};
    const el = map[cat]; if(!el) return;
    el.classList.add('blink'); setTimeout(()=>el.classList.remove('blink'), 700);
  }
  // prosty blink ikonek w logo (je≈õli id w SVG istniejƒÖ)
  function svgBlink(cat){
    try{
      const svg = logoSvg.contentDocument; if(!svg) return;
      const ids = {food:'#icon-food', taxi:'#icon-taxi', hotel:'#icon-hotel'};
      const el = svg.querySelector(ids[cat]);
      if(!el) return;
      el.style.transition='filter .2s ease';
      el.style.filter='drop-shadow(0 0 8px #45caff)';
      setTimeout(()=>{ el.style.filter='none'; }, 700);
    }catch(e){}
  }

  function summarize(text){
    if(!text) return;
    const cat = category(text);
    const time = timeOf(text);
    const qty  = (cat==='food') ? quantityOf(text) : null;
    const dish = (cat==='food') ? dishOf(text) : null;
    const place= placeOf(text);

    blinkTile(cat); svgBlink(cat);

    const items=[{icon:'‚úÖ',text:'Status: gotowe'}];
    if(cat==='food'){
      items.push({icon:'üçΩÔ∏è',text:`Danie: ${[qty?qty+'x':null, dish||'‚Äî'].filter(Boolean).join(' ')}`});
      if(time) items.push({icon:'‚è±',text:`Czas: ${time}`});
      items.push({icon:'üí≤',text:'Cena: demo'});
    }else if(cat==='taxi'){
      items.push({icon:'üöï',text:'Taxi: zam√≥wienie przyjƒôte'});
      if(place) items.push({icon:'üìç',text:`Kierunek: ${place}`});
      items.push({icon:'‚è±',text:'Szacowany czas: 10‚Äì15 min'});
      items.push({icon:'üí≤',text:'Cena: demo'});
    }else{
      items.push({icon:'üè®',text:'Hotel: zapytanie wys≈Çane'});
      if(time) items.push({icon:'üìÖ',text:`Godzina: ${time}`});
    }
    showToast(items);
  }

  function initSTT(){
    if(recognition) return;
    const Ctor = window.webkitSpeechRecognition || window.SpeechRecognition;
    if(!Ctor){ setTxt('Rozpoznawanie mowy jest dostƒôpne w Chrome/Edge.'); return; }
    recognition = new Ctor();
    recognition.lang='pl-PL';
    recognition.continuous=true;
    recognition.interimResults=true;

    recognition.onstart=()=>{
      isListening=true; addMicGlow(true); setTxt('S≈Çucham‚Ä¶'); transcript.scrollIntoView({block:'end'});
      finalOnly='';
    };
    recognition.onresult=(e)=>{
      let interim='';
      for(let i=e.resultIndex;i<e.results.length;i++){
        const r=e.results[i];
        if(r.isFinal) finalOnly = clean((finalOnly + ' ' + r[0].transcript).trim());
        else interim += r[0].transcript;
      }
      setTxt(clean((finalOnly + ' ' + interim).trim()));
    };
    recognition.onerror=()=> stopSTT();
    recognition.onend=()=>{ isListening=false; addMicGlow(false); summarize(finalOnly); };
  }
  function startSTT(){ try{ initSTT(); recognition && recognition.start(); }catch(e){} }
  function stopSTT(){ try{ recognition && recognition.stop(); }catch(e){} }

  // UI bindings
  logoBtn.addEventListener('click', ()=>{ isListening ? stopSTT() : startSTT(); });
  [tileFood,tileTaxi,tileHotel].forEach((el,i)=>{
    el.addEventListener('click', ()=>{
      const cat = i===0?'food':i===1?'taxi':'hotel';
      summarize(cat==='food'?'pizza na 18:00':cat==='taxi'?'taxi do centrum':'hotel dzi≈õ');
    });
  });

  // wy≈ÇƒÖcz focus-outline / tap highlight ju≈º w CSS (logo-hit)

  </script>
</body>
</html>
