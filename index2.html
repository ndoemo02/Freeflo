<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FreeFlow ‚Äî voice + kropla</title>
<style>
:root{ --bg:#0b0c10; --txt:#f1f1f1; --accent:#00e5ff; --accent2:#ffb300; }
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%}
body{
  margin:0; color:var(--txt);
  background: radial-gradient(1200px 800px at 50% 20%, #141824, var(--bg));
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  overflow:hidden;
}

/* Pasek u g√≥ry */
.topbar{
  position:fixed; inset:0 0 auto 0; height:56px; z-index:3000;
  display:flex; align-items:center; justify-content:space-between;
  padding:0 12px; background:linear-gradient(180deg, rgba(10,10,15,.92), rgba(10,10,15,.55));
  backdrop-filter: blur(8px); border-bottom:1px solid rgba(255,255,255,.06);
}
.brand{font-weight:800; letter-spacing:.5px}
.top-actions{display:flex; gap:8px}
.icon-btn{
  height:36px; min-width:40px; padding:0 10px; border:0; border-radius:10px;
  background:#1f2330; color:var(--txt); font-size:18px; cursor:pointer;
}
.icon-btn:active{transform:translateY(1px)}
.badge{font-size:12px;background:var(--accent2);color:#1a1a1a;padding:1px 6px;border-radius:999px;margin-left:4px}

/* Menu */
.dropdown{
  position:fixed; top:60px; right:10px; z-index:2500; display:none; flex-direction:column; gap:8px;
  background:#141724; padding:10px; border-radius:14px; border:1px solid rgba(255,255,255,.08);
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}
.dropdown.open{display:flex}
.dropdown button{
  background:#202433; color:var(--txt); border:0; border-radius:10px; padding:10px 12px; cursor:pointer; text-align:left;
}
.dropdown button:hover{background:#2a2f42}

/* BANER do odblokowania autoplay */
.toast{
  position:fixed; left:50%; transform:translateX(-50%); top:64px; z-index:2600;
  background:#222632; color:var(--txt); border:1px solid rgba(255,255,255,.1);
  padding:10px 14px; border-radius:12px; font-size:14px; display:none;
}
.toast.show{display:block}

/* ---- KROPLA ---- */
:root{ --logo-url: url("https://raw.githubusercontent.com/ndoemo02/Freeflo/main/Freeflow-logo.png"); }

.logo-zone{
  position:fixed; top:72px; left:50%; transform:translateX(-50%);
  width:min(76vw,380px); aspect-ratio:2/3; z-index:2000;
  filter: drop-shadow(0 10px 20px rgba(0,0,0,.6));
}

/* Sam obraz jako maska ‚Äì wycina wszystko w kszta≈Çt kropli */
.droplet{
  position:absolute; inset:0; 
  background: var(--txt);
  -webkit-mask-image: var(--logo-url);
  mask-image: var(--logo-url);
  -webkit-mask-repeat:no-repeat; mask-repeat:no-repeat;
  -webkit-mask-position:center; mask-position:center;
  -webkit-mask-size:contain; mask-size:contain;
  /* filtr SVG: usu≈Ñ czarne t≈Ço z PNG (robimy to poprzez na≈Ço≈ºenie obrazu <img> z filtrem pod spodem) */
}

/* Podk≈Çad: obraz z filtrem progu czerni (dla kompatybilno≈õci) */
.logo-svg{
  position:absolute; inset:0; width:100%; height:100%;
}

/* Fale/obram√≥wka w KSZTA≈ÅCIE KROPLI ‚Äî trzy warstwy */
.wave, .wave::before, .wave::after{
  content:""; position:absolute; inset:0;
  -webkit-mask-image: var(--logo-url);
  mask-image: var(--logo-url);
  -webkit-mask-repeat:no-repeat; mask-repeat:no-repeat;
  -webkit-mask-position:center; mask-position:center;
  -webkit-mask-size:contain; mask-size:contain;
  pointer-events:none;
}
.wave{ opacity:0; transition:opacity .25s ease; }
.wave::before, .wave::after{
  border-radius:0; /* kszta≈Çt daje maska logo */
}

/* Obw√≥dka: robimy neon po obrysie przez ‚Äûramkƒô‚Äù paddingowƒÖ i cienie */
.wave::before{
  background: transparent;
  box-shadow: 0 0 24px rgba(0,229,255,.35), inset 0 0 18px rgba(0,229,255,.2);
  transform: scale(1.015);
  animation: breathe 2.4s ease-in-out infinite;
}
.wave::after{
  background: transparent;
  box-shadow: 0 0 28px rgba(0,229,255,.45), inset 0 0 22px rgba(0,229,255,.28);
  transform: scale(1.04);
  animation: spin 6s linear infinite;
}

/* Stan nagrywania = fale widoczne i neon */
.recording .wave{ opacity:1 }
.clicked .logo-zone{ animation:pulse 500ms ease-out }

/* Dolny pasek */
.bottom-bar{
  position:fixed; left:50%; transform:translateX(-50%); bottom:14px; z-index:2200;
  display:flex; gap:10px; padding:6px 8px;
  background:rgba(10,10,16,.6); backdrop-filter: blur(10px);
  border:1px solid rgba(255,255,255,.08); border-radius:16px;
}
.pill{
  border:0; border-radius:999px; padding:10px 14px; font-weight:700; cursor:pointer;
  background:linear-gradient(180deg,#ffc400,#ff8f00); color:#1a1a1a;
}
.pill:active{transform:translateY(1px)}

/* Animacje */
@keyframes pulse{
  0%{ transform:translateX(-50%) scale(1); filter:drop-shadow(0 0 0 rgba(0,229,255,0)) }
  50%{ transform:translateX(-50%) scale(1.06); filter:drop-shadow(0 0 20px rgba(0,229,255,.55)) }
  100%{ transform:translateX(-50%) scale(1); filter:drop-shadow(0 0 0 rgba(0,229,255,0)) }
}
@keyframes spin{ to{ transform: rotate(360deg) } }
@keyframes breathe{ 0%,100%{ transform: scale(1.01) } 50%{ transform: scale(1.04) } }

@media (max-width:400px){
  .logo-zone{ width:78vw }
  .pill{ padding:10px 12px; font-size:15px }
}
</style>
</head>
<body>
  <header class="topbar">
    <div class="brand">FreeFlow</div>
    <nav class="top-actions">
      <button class="icon-btn" aria-label="Menu" onclick="toggleMenu()">‚ò∞</button>
      <button class="icon-btn" aria-label="Koszyk" onclick="openCart()">üõí <span class="badge" id="cartCount">0</span></button>
    </nav>
  </header>

  <div class="dropdown" id="mainMenu">
    <button onclick="selectPay('blik')">P≈Çatno≈õƒá: BLIK</button>
    <button onclick="selectPay('karta')">P≈Çatno≈õƒá: Karta</button>
    <button onclick="selectPay('got√≥wka')">P≈Çatno≈õƒá: Got√≥wka</button>
  </div>

  <div id="audioToast" class="toast">üîä Stuknij, aby odtworzyƒá komunikat</div>

  <!-- STREFA LOGO -->
  <div class="logo-zone" id="logoZone" onclick="toggleVoice()">
    <!-- Obraz z progiem czerni (SVG) -->
    <svg class="logo-svg" viewBox="0 0 768 1152" aria-hidden="true">
      <defs>
        <filter id="removeBlack" color-interpolation-filters="sRGB">
          <feColorMatrix type="matrix" values="
            0.2126 0.7152 0.0722 0 0
            0.2126 0.7152 0.0722 0 0
            0.2126 0.7152 0.0722 0 0
            0       0       0       1 0" result="lum"/>
          <feComponentTransfer in="lum" result="a">
            <feFuncR type="identity"/><feFuncG type="identity"/><feFuncB type="identity"/>
            <feFuncA type="linear" slope="5" intercept="-0.9"/>
          </feComponentTransfer>
          <feComposite operator="in" in="SourceGraphic" in2="a"/>
        </filter>
      </defs>
      <image href="https://raw.githubusercontent.com/ndoemo02/Freeflo/main/Freeflow-logo.png"
             x="0" y="0" width="768" height="1152" preserveAspectRatio="xMidYMid meet" filter="url(#removeBlack)"/>
    </svg>

    <!-- Kropla (maskowana warstwa ‚Äì klikalny ‚Äûprzycisk‚Äù) -->
    <div class="droplet"></div>
    <!-- Fale/obram√≥wka w KSZTA≈ÅCIE KROPLI -->
    <div class="wave"></div>
  </div>

  <!-- DOLNE PRZYCISKI -->
  <div class="bottom-bar">
    <button class="pill" onclick="quickIntent('Jedzenie')">üçΩÔ∏è Jedzenie</button>
    <button class="pill" onclick="quickIntent('Taxi')">üöï Taxi</button>
    <button class="pill" onclick="quickIntent('Hotel')">üè® Hotel</button>
  </div>

<script>
let cart = 0;
let recording = false;
let introSpoken = false;

/* Topbar */
function toggleMenu(){ document.getElementById('mainMenu').classList.toggle('open'); }
function openCart(){ alert('Koszyk (demo). Tu poka≈ºesz listƒô i checkout.'); }
function selectPay(type){ alert(`Wybrano metodƒô p≈Çatno≈õci: ${type.toUpperCase()}`); toggleMenu(); }

/* Quick intents */
function quickIntent(kind){
  cart += 1; document.getElementById('cartCount').textContent = cart;
  speak(`Wybrano: ${kind}. Dodano do koszyka.`);
}

/* Voice ON/OFF */
function toggleVoice(){
  if(!introSpoken){ sayIntro(); } // je≈õli intro jeszcze nie pad≈Ço, pu≈õƒá je najpierw
  recording = !recording;
  document.body.classList.toggle('recording', recording);
  document.body.classList.add('clicked');
  setTimeout(()=>document.body.classList.remove('clicked'), 500);

  if(recording){
    speak('Nagrywanie w≈ÇƒÖczone. S≈Çucham.');
    // startRecording(); // TU podepniesz realny capture
  }else{
    speak('Nagrywanie wy≈ÇƒÖczone.');
    // stopRecording();
  }
}

/* TTS damski PL */
function speak(text){
  try{
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'pl-PL';
    const voices = speechSynthesis.getVoices();
    const prefer = voices.find(v => v.lang.startsWith('pl') && /female|Zosia|Paulina|Agata|Agnieszka|Ewa|Maja/i.test(v.name));
    const anyPL = voices.find(v => v.lang.startsWith('pl'));
    u.voice = prefer || anyPL || null;
    u.rate = 1; u.pitch = 1; u.volume = 1;
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }catch(e){ console.warn('SpeechSynthesis error:', e); }
}

/* Intro + polityka autoplay */
const introText = 'W celu z≈Ço≈ºenia zam√≥wienia proszƒô nacisnƒÖƒá przycisk.';
function sayIntro(){
  if(introSpoken) return;
  introSpoken = true;
  hideToast();
  speak(introText);
}
function showToast(){ document.getElementById('audioToast').classList.add('show'); }
function hideToast(){ document.getElementById('audioToast').classList.remove('show'); }

function attachUnlockOnce(){
  const unlock = ()=>{
    sayIntro();
    window.removeEventListener('pointerdown', unlock, {passive:true});
    window.removeEventListener('touchstart', unlock, {passive:true});
    window.removeEventListener('click', unlock, {passive:true});
  };
  window.addEventListener('pointerdown', unlock, {passive:true});
  window.addEventListener('touchstart', unlock, {passive:true});
  window.addEventListener('click', unlock, {passive:true});
}

function tryAutoplay(){
  // Spr√≥buj od razu przem√≥wiƒá
  speak(introText);
  // Po kr√≥tkiej chwili sprawd≈∫, czy przem√≥wi≈Ço
  setTimeout(()=>{
    if(!speechSynthesis.speaking){
      // Autoplay zablokowany ‚Äì poka≈º baner i czekaj na pierwszy tap
      showToast();
      attachUnlockOnce();
    }else{
      introSpoken = true;
      hideToast();
    }
  }, 700);
}

/* iOS/webview potrafi ≈Çadowaƒá g≈Çosy asynchronicznie */
if(typeof speechSynthesis !== 'undefined'){
  speechSynthesis.onvoiceschanged = ()=>{};
}

window.addEventListener('load', tryAutoplay, {once:true});
</script>
</body>
</html>
