<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FreeFlow ‚Äî Voice to order</title>
  <meta name="theme-color" content="#0f1218" />

  <style>
    :root{
      --bg:#0f1218;
      --panel:#121721;
      --text:#e9edf5;
      --muted:#9aa3b2;
      --brand:#ff7a19;   /* pomara≈Ñcz */
      --brand-dim:#c95f12;
      --ring:#ff7a19aa;
    }
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0; font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 50% -200px, #26314266, transparent 60%),
        radial-gradient(800px 400px at 20% 0, #1b223055, transparent 60%),
        var(--bg);
    }

    .wrap{ max-width:980px; margin:0 auto; padding:24px 20px 56px }
    header{ display:flex; align-items:center; gap:12px; margin-bottom:18px }
    .logo{ font-size:36px; font-weight:800; letter-spacing:.3px }
    .logo .free{ color:var(--brand) }
    .logo .flow{ color:#fff }
    .subtitle{ color:var(--muted); font-weight:600; margin-left:6px }

    h1{
      font-size:48px; line-height:1.05; margin:18px 0 10px; letter-spacing:.2px;
    }
    .tagline{ color:var(--muted); margin-bottom:16px; font-size:18px }

    /* HERO */
    .hero{
      position:relative; display:grid; place-items:center;
      width:min(680px, 92vw); aspect-ratio:1/1;
      margin:18px auto 18px;
      border-radius:50%;
      background: radial-gradient(60% 60% at 50% 45%, #1a2230 0%, #0f141c 65%, #0b0f15 100%);
      box-shadow:
        0 0 0 2px #2a3140 inset,
        0 0 80px 10px #000 inset,
        0 0 0 1px #000,
        0 20px 60px #000;
      overflow:hidden;
    }
    .hero::before{
      content:""; position:absolute; inset:10px; border-radius:50%;
      background:
        conic-gradient(from 0deg, #ff7a19 0 14%, #ffb36a 14% 16%, transparent 16% 18%, #6ad4ff 18% 32%, transparent 32% 34%, #b36aff 34% 48%, transparent 48% 50%, #ff7a19 50% 64%, transparent 64% 66%, #ffb36a 66% 82%, transparent 82% 84%, #6ad4ff 84% 100%);
      filter: blur(28px) saturate(120%);
      opacity:.18; pointer-events:none;
    }
    .hero img{
      width:78%; max-width:520px; filter: drop-shadow(0 12px 28px #000) saturate(110%);
      transform: translateY(-4px);
      user-select:none; -webkit-user-drag:none;
    }

    /* guzik mic */
    .cta{
      position:absolute; bottom:26px; left:50%; transform:translateX(-50%);
      background:linear-gradient(#191f2a, #151a23);
      border:1px solid #2a3242; color:#dbe2ee;
      padding:16px 22px; border-radius:18px; font-size:18px;
      display:flex; align-items:center; gap:10px;
      box-shadow:
        0 4px 14px rgba(0,0,0,.6),
        0 0 0 0 var(--ring);
      transition: .2s ease;
      cursor:pointer;
    }
    .cta:active{ transform:translateX(-50%) translateY(1px) }
    .cta.pulse{ animation:pulse 1.6s infinite }
    @keyframes pulse{
      0%{ box-shadow:0 0 0 0 var(--ring) }
      70%{ box-shadow:0 0 0 16px transparent }
      100%{ box-shadow:0 0 0 0 transparent }
    }

    /* transcript */
    .bubble{
      max-width:820px; margin:16px auto 6px;
      background:linear-gradient(180deg, #151a24, #11161f);
      border:1px solid #283142; border-radius:18px;
      padding:16px 18px; font-size:18px; color:#e6ecf7;
      display:flex; align-items:center; gap:10px;
      box-shadow: 0 8px 24px rgba(0,0,0,.55);
    }
    .dot{ width:10px; height:10px; border-radius:50%; background:#2ecc71; box-shadow:0 0 0 3px #2ecc7133 }
    .actions{ display:flex; gap:14px; justify-content:center; margin-top:18px }
    .chip{
      padding:14px 18px; border-radius:16px;
      background:linear-gradient(#191f2a, #151a23);
      border:1px solid #2a3242; color:#dbe2ee; font-weight:600;
      box-shadow:0 6px 18px rgba(0,0,0,.55);
    }
    .chip--brand{
      color:var(--brand); border-color:#3a1f10; background:linear-gradient(#1b120c, #140e09);
      box-shadow: 0 0 0 1px #3a1f10 inset, 0 10px 22px rgba(0,0,0,.6), 0 0 24px #ff7a191f;
    }

    @media (max-width:540px){
      h1{ font-size:36px }
      .cta{ font-size:16px; padding:14px 18px }
      .bubble{ font-size:16px }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">
        <span class="free">Free</span><span class="flow">Flow</span>
      </div>
      <div class="subtitle">Voice to<br>order</div>
    </header>

    <h1>Z≈Ç√≥≈º zam√≥wienie</h1>
    <div class="tagline">Taxi, posi≈Çek, a mo≈ºe nocleg?</div>

    <section class="hero">
      <!-- UWAGA: nazwa pliku jest czu≈Ça na wielko≈õƒá liter -->
      <img src="./Freeflow-logo.png" alt="FreeFlow logo" />
      <button id="micBtn" class="cta" aria-label="M√≥w">
        <span>üé§</span> <span>Dotknij logo i m√≥w‚Ä¶</span>
      </button>
    </section>

    <div class="bubble">
      <span id="stateDot" class="dot" aria-hidden="true"></span>
      <div id="transcript">Transkrypcja pojawi siƒô tutaj‚Ä¶</div>
    </div>

    <div class="actions">
      <div class="chip chip--brand">üçΩÔ∏è Jedzenie</div>
      <div class="chip">üöï Taxi</div>
      <div class="chip">üè® Hotel</div>
    </div>
  </div>

  <audio id="ttsPlayer" preload="auto"></audio>

  <script>
    const API_URL = 'https://freeflow-backend-vercel.vercel.app/api/assistant-text';

    const micBtn = document.getElementById('micBtn');
    const transcriptBox = document.getElementById('transcript');
    const stateDot = document.getElementById('stateDot');
    const player = document.getElementById('ttsPlayer');

    function setState(s){
      const map = { idle:'#2ecc71', listen:'#f1c40f', think:'#3498db', err:'#e74c3c' };
      stateDot.style.background = map[s] || map.idle;
      micBtn.classList.toggle('pulse', s==='listen');
    }
    function show(t){ transcriptBox.textContent = t }

    async function playBase64Mp3(b64){
      try{ player.src = `data:audio/mpeg;base64,${b64}`; await player.play(); return true; }
      catch(e){ return false; }
    }
    function speakFallback(text){
      try{ const u=new SpeechSynthesisUtterance(text); u.lang='pl-PL'; speechSynthesis.cancel(); speechSynthesis.speak(u); }catch{}
    }

    async function sendToAssistant(text){
      try{
        setState('think');
        const r = await fetch(API_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text})});
        const data = await r.json();
        if(!data.success){ setState('err'); show('B≈ÇƒÖd serwera'); speakFallback('WystƒÖpi≈Ç b≈ÇƒÖd serwera.'); return; }
        const answer = data.assistantText || 'OK';
        show(answer);
        if (data.audioBase64){
          const ok = await playBase64Mp3(data.audioBase64);
          if(!ok) speakFallback(answer);
        } else { speakFallback(answer); }
        setState('idle');
      }catch(e){ setState('err'); show('Problem z po≈ÇƒÖczeniem'); speakFallback('Nie uda≈Ço siƒô po≈ÇƒÖczyƒá z serwerem.'); }
    }

    function startASR(){
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if(!SR){ alert('Twoja przeglƒÖdarka nie wspiera rozpoznawania mowy (spr√≥buj Chrome)'); return; }
      const rec = new SR();
      rec.lang = 'pl-PL'; rec.interimResults = true; rec.maxAlternatives = 1;
      rec.onstart = ()=>{ setState('listen'); show('S≈Çucham‚Ä¶') };
      rec.onerror = ()=>{ setState('err'); show('B≈ÇƒÖd rozpoznawania') };
      rec.onresult = (e)=>{
        let final='', inter='';
        for(let i=e.resultIndex;i<e.results.length;i++){
          const t=e.results[i][0].transcript;
          e.results[i].isFinal ? final+=t+' ' : inter+=t;
        }
        show((final||inter).trim());
      };
      rec.onend = ()=>{
        const txt = transcriptBox.textContent.trim();
        if (txt) sendToAssistant(txt); else setState('idle');
      };
      rec.start();
    }

    micBtn.addEventListener('click', ()=>{
      try{ speechSynthesis.cancel(); player.pause(); }catch{}
      startASR();
    });

    setState('idle');
  </script>
</body>
</html>
