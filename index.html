<main class="wrap">
  <style>
    :root{
      --text:#e9eef6; --muted:#aec0d6; --brand:#ff7a00;
      --glass: rgba(0,0,0,.22); --stroke: rgba(255,255,255,.10);
    }
    * { -webkit-tap-highlight-color: transparent; }
    body{
      margin:0; color:var(--text);
      font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;
      background:#0b0f14 url("assets/Background.png") center/cover fixed no-repeat;
      overflow-x:hidden;
    }
    .wrap{ max-width:980px; margin:0 auto; padding:18px 16px 26px; }
    header{ display:flex; align-items:center; gap:12px; }
    .brand{ font-weight:800; font-size:32px; letter-spacing:.5px;}
    .brand em{ color:var(--brand); font-style:normal; }
    .subtitle{ color:var(--muted); margin-top:2px; font-size:14px }

    h1{ font-size:44px; line-height:1.06; margin:20px 0 8px }
    .lead{ color:var(--muted); font-size:18px; margin-bottom:8px }

    /* LOGO */
    .hero{ margin:10px auto 10px; width:min(92vw,560px); aspect-ratio:1/1; display:grid; place-items:center; }
    #ffLogo{ width:100%; height:100%; display:block; cursor:pointer; }
    /* puls ‚Äûoddech‚Äù ca≈Çego znaku */
    #ffLogo .badge { filter:url(#glow); transform-origin:50% 50%; animation:badgePulse 2.6s ease-in-out infinite; }
    @keyframes badgePulse{ 0%,100%{transform:scale(1)} 50%{transform:scale(1.012)} }
    /* punktowy glow mikrofonu sterowany klasƒÖ .listening na <svg> */
    #ffLogo .mic-glow{ opacity:0; transition:opacity .22s ease, transform .22s ease; }
    #ffLogo.listening .mic-glow{ opacity:1; animation:micWave 1.35s ease-in-out infinite; }
    @keyframes micWave{ 0%,100%{ transform:scale(.94)} 50%{ transform:scale(1.08)} }

    /* Transkrypcja ‚Äì wy≈ºej, aby by≈Ço widaƒá kroplƒô */
    .bubble{
      margin:8px auto 0; max-width:900px; padding:14px 16px; min-height:48px;
      background:var(--glass); border:1px solid var(--stroke); border-radius:16px;
      font-size:18px; backdrop-filter: blur(8px);
    }
    .bubble .dot{ width:8px; height:8px; border-radius:50%; background:#83d0ff; display:inline-block; margin-right:10px; }
    .controls{ display:flex; gap:12px; margin-top:14px; }

    /* Kafelki na dole ‚Äì pojedyncze, bez obw√≥dki grupowej, napisy bia≈Çe */
    .dock{
      position:fixed; left:0; right:0; bottom:14px;
      display:flex; gap:14px; justify-content:center; padding:0 16px; pointer-events:none;
    }
    .tile{
      pointer-events:auto; width:min(32%, 360px); min-width:160px;
      display:flex; align-items:center; justify-content:center; gap:10px;
      padding:16px 18px; border-radius:18px; background:var(--glass); border:1px solid var(--stroke);
      backdrop-filter: blur(10px); color:#fff; font-weight:600; font-size:18px;
    }
    .tile span{ opacity:.95 }
    .tile:active{ transform:translateY(1px); }

    @media (max-width:520px){
      h1{ font-size:36px } .hero{ width:min(94vw,520px) }
      .tile{ font-size:17px; padding:14px 16px }
    }
  </style>

  <header>
    <div class="brand"><em>Free</em> Flow</div>
  </header>
  <div class="subtitle">Voice to order ‚Äî tryb testowy, bez profilowania</div>

  <h1>Z≈Ç√≥≈º zam√≥wienie</h1>
  <div class="lead">Jedzenie, Taxi albo nocleg ‚Äî powiedz lub kliknij.</div>

  <!-- LOGO INLINE (SVG) -->
  <section class="hero" aria-label="Logo FreeFlow ‚Äì naci≈õnij, aby m√≥wiƒá">
    <!-- Je≈õli wolisz PNG w ≈õrodku, podmie≈Ñ href w <image> poni≈ºej na assets/freeflow-core.png -->
    <svg id="ffLogo" viewBox="0 0 600 600" role="button" tabindex="0" aria-pressed="false">
      <defs>
        <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="6" result="b"/>
          <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
        <radialGradient id="micRad" cx="50%" cy="50%" r="50%">
          <stop offset="0%" stop-color="#00d8ff" stop-opacity=".85"/>
          <stop offset="60%" stop-color="#00d8ff" stop-opacity=".22"/>
          <stop offset="100%" stop-color="#00d8ff" stop-opacity="0"/>
        </radialGradient>
      </defs>
      <!-- Ca≈Çy znak (tu mo≈ºe byƒá <image href="assets/freeflow-core.png"> je≈õli masz PNG z alfa) -->
      <g class="badge">
        <image href="assets/Freeflowlogo.png" x="0" y="0" width="600" height="600"/>
      </g>
      <!-- Blask mikrofonu ‚Äì ustaw translate tak, by trafia≈Ç w kapsu≈Çƒô mikrofonu -->
      <g class="mic-glow" transform="translate(300,230)">
        <circle r="78" fill="url(#micRad)"/>
      </g>
    </svg>
  </section>

  <!-- Transkrypcja (wy≈ºej, kropla widoczna) -->
  <div id="transcript" class="bubble" aria-live="polite">
    <span class="dot"></span><span id="transText">Powiedz, co chcesz zam√≥wiƒá‚Ä¶</span>
  </div>

  <!-- Dock z kafelkami -->
  <nav class="dock" aria-label="Szybkie akcje">
    <button class="tile" data-kind="food">üçΩÔ∏è <span>Jedzenie</span></button>
    <button class="tile" data-kind="taxi">üöï <span>Taxi</span></button>
    <button class="tile" data-kind="hotel">üè° <span>Hotel</span></button>
  </nav>

  <script>
    // --------- Speech: start/stop + glow mikrofonu ---------
    const logo = document.getElementById('ffLogo');
    const transText = document.getElementById('transText');

    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recog, listening = false, lastFinal = '';

    function setListening(on){
      listening = !!on;
      logo.classList.toggle('listening', listening);
      logo.setAttribute('aria-pressed', String(listening));
    }

    function ensureSR(){
      if (!SR) return null;
      if (recog) return recog;
      recog = new SR();
      recog.lang = 'pl-PL';
      recog.interimResults = true;
      recog.continuous = false;

      recog.onstart = () => setListening(true);
      recog.onend   = () => setListening(false);

      recog.onresult = (e)=>{
        let interim = '', finalTxt = '';
        for (let i= e.resultIndex; i< e.results.length; i++){
          const tr = e.results[i][0].transcript.trim();
          if (e.results[i].isFinal) finalTxt += tr + ' ';
          else interim += tr + ' ';
        }
        // anty-echo: je≈ºeli final siƒô powt√≥rzy≈Ç ‚Äî nie duplikuj
        finalTxt = finalTxt.trim();
        if (finalTxt && finalTxt !== lastFinal){
          lastFinal = finalTxt;
          transText.textContent = finalTxt;
          // TODO: tu wo≈Çasz sw√≥j parser/intent
        } else if (interim){
          transText.textContent = interim.trim();
        }
      };
      return recog;
    }

    function startSR(){
      const r = ensureSR();
      if (!r){ transText.textContent = 'Rozpoznawanie mowy dostƒôpne w Chrome/Edge.'; return; }
      try{ r.start(); }catch(_){ /* ignore double-start */ }
    }

    logo.addEventListener('click', startSR);
    logo.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); startSR(); } });

    // --------- Kafelki: szybkie podpowiedzi ---------
    document.querySelectorAll('.tile').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const kind = btn.dataset.kind;
        if (kind==='food') transText.textContent = 'Przyk≈Çad: dwie pepperoni na 18:00';
        if (kind==='taxi') transText.textContent = 'Przyk≈Çad: zam√≥w taxi na 20:00 do Katowic';
        if (kind==='hotel') transText.textContent = 'Przyk≈Çad: zarezerwuj hotel na jutro';
      });
    });
  </script>
</main>
