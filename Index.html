<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Freeflo ‚Äî Voice to Order</title>
  <meta name="theme-color" content="#000000" />
  <style>
    html,body{height:100%;margin:0;background:#000;color:#eaeaea;font:16px/1.5 system-ui,Segoe UI,Roboto,Arial}
    .wrap{min-height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:22px;padding:24px}
    h1{margin:0;text-align:center;font-size:clamp(22px,5vw,36px);color:#e6e6e6}
    .hint{opacity:.75;text-align:center}
    .mic{width:110px;height:110px;border-radius:50%;position:relative;display:grid;place-items:center;
         background:#0d1117;border:4px solid rgba(255,165,0,.25);
         box-shadow:0 10px 34px rgba(255,120,0,.25), inset 0 0 30px rgba(255,120,0,.12);
         overflow:hidden;cursor:pointer;transition:transform .15s ease}
    .mic:active{transform:scale(.97)}
    .disc{position:absolute;inset:0;border-radius:50%;background:radial-gradient(circle at 30% 30%,#ffb347 0%,#ff6a00 35%,#a23bff 80%);opacity:.22;filter:blur(10px)}
    .emoji{font-size:42px;z-index:1}
    .ring{position:absolute;inset:0;border-radius:9999px;border:2px solid rgba(255,140,0,.38);opacity:0;pointer-events:none}
    .pulse{animation:pulse 1.8s ease-out infinite}
    .p2{animation-delay:.25s}.p3{animation-delay:.5s}
    @keyframes pulse{from{transform:scale(.9);opacity:.7}to{transform:scale(1.9);opacity:0}}
    .badge{font-size:12px;padding:6px 10px;border-radius:9999px;background:rgba(255,165,0,.12);color:#ffb347;border:1px solid rgba(255,165,0,.2)}
    .out{max-width:min(780px,92vw);padding:12px 14px;border-radius:14px;background:#0d1117;color:#d6d8db;border:1px solid rgba(255,255,255,.06);min-height:22px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:center}
    .btn{appearance:none;border:0;border-radius:10px;padding:10px 14px;background:#1f6feb;color:#fff}
    .btn:disabled{opacity:.5}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>W czym<br>mogƒô<br>s≈Çu≈ºyƒá?</h1>
    <div id="badge" class="badge">Gotowy</div>

    <button id="mic" class="mic" aria-label="Start/Stop">
      <span class="disc"></span>
      <span class="emoji">üé§</span>
      <span id="r1" class="ring"></span>
      <span id="r2" class="ring"></span>
      <span id="r3" class="ring"></span>
    </button>

    <div id="out" class="out"></div>

    <div class="row">
      <button id="testOrder" class="btn" type="button">Podpowiedz frazy</button>
      <button id="stopTTS" class="btn" type="button">Wy≈ÇƒÖcz lektora</button>
    </div>

    <div class="hint">Kliknij przycisk i powiedz: ‚Äûczy mogƒô z≈Ço≈ºyƒá zam√≥wienie‚Äù, ‚Äûdwie pizze pepperoni‚Äù, ‚Äûcola zero x2‚Äù, ‚Äûanuluj‚Äù.</div>
  </div>

<script>
  // UI refs
  const mic = document.getElementById('mic');
  const badge = document.getElementById('badge');
  const out = document.getElementById('out');
  const r1 = document.getElementById('r1'), r2 = document.getElementById('r2'), r3 = document.getElementById('r3');
  const btnTips = document.getElementById('testOrder');
  const btnStopTTS = document.getElementById('stopTTS');

  // Web Speech
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  let recog = null, active = false;

  function speak(text, lang='pl-PL'){
    try{
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = lang; u.rate = 1; u.pitch = 1;
      speechSynthesis.speak(u);
    }catch(e){ console.log(e); }
  }

  // Simple NLU
  const MENU = {
    pizza: { names:['pizza','pepperoni','margherita','margarita'] },
    cola:  { names:['cola','cola zero','coca cola','kola'] },
    woda:  { names:['woda','woda gazowana','woda niegazowana'] }
  };
  const NUM = {"jeden":1,"jedna":1,"jedno":1,"dwa":2,"dwie":2,"trzy":3,"cztery":4,"piƒôƒá":5,"sze≈õƒá":6,"siedem":7,"osiem":8,"dziewiƒôƒá":9,"dziesiƒôƒá":10};
  const norm = s => s.toLowerCase().replace(/[.,!?]/g,' ').replace(/\s+/g,' ').trim();
  const findItem = t => { for(const k in MENU){ for(const n of MENU[k].names){ if(t.includes(n)) return n; } } return null; };
  function findQty(t){ const m=t.match(/\b(\d{1,2})\b/); if(m) return +m[1]; for(const [w,n] of Object.entries(NUM)){ if(t.includes(' '+w+' ')) return n; } if(t.includes('podw√≥j')||t.includes('x2')) return 2; return 1; }

  function handleIntent(text){
    const t = ' ' + norm(text) + ' ';
    if(t.includes('dzie≈Ñ dobry')||t.includes('cze≈õƒá')){ say('Dzie≈Ñ dobry! W czym mogƒô s≈Çu≈ºyƒá?'); return; }
    if(t.includes('anuluj')||t.includes('stop')){ say('Anulowano. Czekam na kolejne polecenie.'); return; }
    if(t.includes('z≈Ço≈ºyƒá zam√≥wienie')||t.includes('zam√≥wiƒá')||t.includes('zam√≥wienie')){ say('Jasne! Co podaƒá do zam√≥wienia?'); return; }
    const item = findItem(t);
    if(item){ const qty = findQty(t); say(`Dodajƒô ${qty} ${item}. Czy potwierdziƒá?`); return; }
    say('Zrozumia≈Çem: '+text+'. Powt√≥rz proszƒô nazwƒô pozycji lub ilo≈õƒá.');
  }

  function say(text){ out.textContent = text; speak(text); }

  // UI helpers
  function startUI(){ active=true; [r1,r2,r3].forEach((e,i)=>{e.classList.add('pulse'); e.style.opacity=1; e.classList.toggle('p2',i===1); e.classList.toggle('p3',i===2);}); badge.textContent='Nas≈Çuchujƒô‚Ä¶'; }
  function stopUI(){ active=false; [r1,r2,r3].forEach(e=>{e.classList.remove('pulse'); e.style.opacity=0;}); badge.textContent='Gotowy'; }

  function startRec(){
    if(!SR){ out.textContent='Web Speech API niedostƒôpne. U≈ºyj Chrome na Androidzie (HTTPS).'; return; }
    recog = new SR(); recog.lang='pl-PL'; recog.continuous=true; recog.interimResults=true;
    recog.onresult = (e)=>{
      let final='';
      for(let i=e.resultIndex;i<e.results.length;i++){ const r=e.results[i]; if(r.isFinal) final += r[0].transcript; }
      const interim = e.results[e.results.length-1][0].transcript;
      out.textContent = (final||interim).trim();
      if(final){ handleIntent(final); }
    };
    recog.onend = () => { stopUI(); };
    try{ recog.start(); }catch{}
  }

  function toggle(){
    if(!active){ startUI(); startRec(); if(navigator.vibrate) try{ navigator.vibrate([40,20,40]); }catch{} }
    else { if(recog) try{ recog.stop(); }catch{} stopUI(); }
  }

  mic.addEventListener('click', toggle);
  btnTips.addEventListener('click', ()=>say('Powiedz: ‚Äûczy mogƒô z≈Ço≈ºyƒá zam√≥wienie‚Äù, ‚Äûdwie pizze pepperoni‚Äù, ‚Äûcola zero x2‚Äù, ‚Äûanuluj‚Äù.'));
  btnStopTTS.addEventListener('click', ()=>window.speechSynthesis.cancel());
</script>
</body>
</html>
