<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>FreeFlow ‚Äî zam√≥w g≈Çosem</title>
  <meta name="theme-color" content="#0b0f14">
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b0f14;--text:#eef3fb;--muted:#a6b2c3;--glass:rgba(0,0,0,.35);--stroke:rgba(255,255,255,.08);--ring:rgba(0,214,255,.35);--brand:#ff7a00}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;color:var(--text);background:var(--bg) url("assets/Background.png") center/cover fixed no-repeat;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .topbar{position:sticky;top:0;z-index:30;padding:16px 18px;background:linear-gradient(to bottom,rgba(11,15,20,.95),rgba(11,15,20,.6),transparent)}
    .brand{display:flex;flex-direction:column;gap:4px}
    .brand .row{display:flex;gap:6px;align-items:baseline}
    .brand .free{color:var(--brand);font:700 clamp(22px,4.5vw,28px)/1 Poppins,system-ui}
    .brand .flow{font:700 clamp(22px,4.5vw,28px)/1 Poppins,system-ui}
    .brand .sub{color:var(--muted);font-size:12px}
    .wrap{max-width:1000px;margin:0 auto;padding:0 16px 88px} /* padding-bottom bo na dole bƒôdzie dock */
    h1{font:700 clamp(28px,7vw,44px)/1.1 Poppins,system-ui;margin:10px 0 6px}
    p.lead{color:var(--muted);margin:0 0 10px}

    .logo-wrap{display:grid;place-items:center;margin:8px 0 16px}
    .logo-btn{position:relative;border:0;background:transparent;border-radius:20px}
    #ffLogo{width:min(84vw,560px);height:auto;display:block;border-radius:20px;pointer-events:none}
    .rings{position:absolute;width:52%;aspect-ratio:1/1;left:50%;top:46%;transform:translate(-50%,-50%);border-radius:50%;
      box-shadow:0 0 0 2px rgba(0,214,255,.25),0 0 34px rgba(255,122,0,.28) inset;opacity:0;transition:opacity .15s}
    .logo-btn.listening .rings{animation:ping 1.2s ease-in-out infinite;opacity:1}
    @keyframes ping{0%{transform:translate(-50%,-50%) scale(.92)}50%{transform:translate(-50%,-50%) scale(1.03)}100%{transform:translate(-50%,-50%) scale(.92)}}

    .bubble{max-width:1000px;margin:10px auto 0;background:var(--glass);border:1px solid var(--stroke);border-radius:16px;padding:14px 16px;font-size:18px}

    /* === DOCK NA DOLE (kafelki) === */
    .dock{position:fixed;left:12px;right:12px;bottom:12px;z-index:40;display:flex;gap:12px;justify-content:center;flex-wrap:nowrap;
      background:var(--glass);border:1px solid var(--stroke);border-radius:18px;padding:10px 10px;backdrop-filter:blur(4px)}
    .pill{flex:1 1 0%;min-width:0;text-align:center;cursor:pointer;padding:12px 14px;border-radius:14px;font-size:16px;
      background:rgba(255,255,255,.04);border:1px solid var(--stroke);outline:2px solid transparent}
    .pill.active{outline:2px solid var(--ring);box-shadow:0 0 0 6px rgba(0,214,255,.08) inset}
    .toast{position:fixed;left:14px;right:14px;bottom:76px;z-index:50;background:var(--glass);border:1px solid var(--stroke);border-radius:16px;padding:14px 16px}
    .cards{max-width:1000px;margin:12px auto 0;display:grid;gap:14px}
    .card{background:var(--glass);border:1px solid var(--stroke);border-radius:16px;padding:14px 16px}
    .card h3{margin:0 0 8px;font:600 18px/1.2 Poppins,system-ui}
    .card ul{margin:0;padding-left:18px;color:var(--muted)}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="row"><span class="free">Free</span><span class="flow">Flow</span></div>
      <span class="sub">Voice to order ‚Äî tryb testowy, bez profilowania</span>
    </div>
  </header>

  <main class="wrap">
    <h1>Z≈Ç√≥≈º zam√≥wienie</h1>
    <p class="lead">Jedzenie, Taxi albo nocleg ‚Äî powiedz lub kliknij.</p>

    <section class="logo-wrap">
      <button id="micBtn" class="logo-btn" aria-label="Naci≈õnij i m√≥w">
        <img id="ffLogo" src="assets/Freeflowlogo.png?v=11" alt="FreeFlow logo">
        <span class="rings"></span>
      </button>
    </section>

    <section id="cardFeed" class="cards"></section>
    <div id="transcript" class="bubble">Powiedz, co chcesz zam√≥wiƒá‚Ä¶</div>
  </main>

  <!-- Dock z kafelkami na samym dole -->
  <nav class="dock" id="dock">
    <button class="pill" data-cat="food">üçΩÔ∏è Jedzenie</button>
    <button class="pill" data-cat="taxi">üöï Taxi</button>
    <button class="pill" data-cat="hotel">üè° Hotel</button>
  </nav>

  <div id="toast" class="toast" hidden></div>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const toastEl = document.getElementById("toast");
      const transEl = document.getElementById("transcript");
      const cardFeed = document.getElementById("cardFeed");
      const micBtn = document.getElementById("micBtn");
      const pills = [...document.querySelectorAll(".pill")];

      function toast(msg, ms=2600){toastEl.textContent=msg;toastEl.hidden=false;clearTimeout(toast._t);toast._t=setTimeout(()=>toastEl.hidden=true,ms);}
      function card(title, lines){const el=document.createElement("article");el.className="card";el.innerHTML=`<h3>${title}</h3><ul>${lines.map(li=>`<li>${li}</li>`).join("")}</ul>`;cardFeed.prepend(el);}
      toast("‚úÖ Aplikacja gotowa ‚Äî JS dzia≈Ça");

      // ==== logika kafelk√≥w (jak wcze≈õniej) ====
      const presets={food:"Zam√≥w capriciosƒô na wiecz√≥r do Demo Partner.",taxi:"Zam√≥w taks√≥wkƒô na 20:00 do Katowic.",hotel:"Zarezerwuj pok√≥j dla dw√≥ch os√≥b w centrum Katowic."};
      function setActive(cat){pills.forEach(p=>p.classList.toggle("active",p.dataset.cat===cat));}
      pills.forEach(p=>p.addEventListener("click",()=>{const cat=p.dataset.cat;setActive(cat);const q=presets[cat]||"Z≈Ç√≥≈º zam√≥wienie.";transEl.textContent=q;handleOrder(q);})); setActive("food");

      // ==== mikrofon po klikniƒôciu logo ====
      function speechSupported(){return "webkitSpeechRecognition" in window || "SpeechRecognition" in window;}
      let rec=null;
      function startRec(){
        if(!speechSupported()){toast("Mikrofon dzia≈Ça w Chrome/Edge (Web Speech API).");return;}
        try{
          const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
          rec=new SR(); rec.lang="pl-PL"; rec.continuous=false; rec.interimResults=true;
          micBtn.classList.add("listening"); transEl.textContent="‚è∫Ô∏è S≈Çucham‚Ä¶";
          let final=""; rec.onresult=(e)=>{let interim=""; for(let i=e.resultIndex;i<e.results.length;i++){const t=e.results[i][0].transcript; e.results[i].isFinal? final+=t+" ": interim+=t;} transEl.textContent=(final+interim).trim();};
          rec.onerror=()=>{micBtn.classList.remove("listening");toast("B≈ÇƒÖd mikrofonu / brak uprawnie≈Ñ.");};
          rec.onend=()=>{micBtn.classList.remove("listening");const q=transEl.textContent.trim(); if(q&&!q.startsWith("‚è∫Ô∏è")) handleOrder(q);};
          rec.start();
        }catch(e){micBtn.classList.remove("listening");toast("B≈ÇƒÖd Web Speech: "+e.message);}
      }
      micBtn.addEventListener("click",startRec);

      // ==== order (backend + cichy mock) ====
      async function handleOrder(query){
        const MOCK={title:"Propozycja (demo)",lines:["‚úÖ Status: gotowe","üè¨ Miejsce: Demo Partner","‚è±Ô∏è Czas: 15‚Äì20 min","üíµ Cena: PLN 38","‚ÑπÔ∏è Info: wersja testowa (mock)."]};
        transEl.textContent=query;
        try{
          const res=await fetch("https://ffend-vercel.vercel.app/api/order?query="+encodeURIComponent(query),{mode:"cors"});
          if(!res.ok) throw new Error("HTTP "+res.status);
          const data=await res.json();
          if(data && data.title && Array.isArray(data.lines)) card(data.title,data.lines); else card(MOCK.title,MOCK.lines);
        }catch{ card(MOCK.title,MOCK.lines); }
      }

      // pierwszy wpis
      card("Witaj w FreeFlow",["Kliknij kafelek na dole albo naci≈õnij logo, by m√≥wiƒá."]);
    });
  </script>
</body>
</html>
