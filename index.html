<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FreeFlow</title>
<style>
  :root{
    --bg:#0b0d0f;
    --fg:#ffffff;
    --accent:#ff7a1a; /* soczysty pomara≈Ñcz */
    --muted:#cfc7bd;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:radial-gradient(1200px 900px at 50% -20%, #13161a 0%, var(--bg) 60%);
    color:var(--fg);
    font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    display:flex; flex-direction:column; align-items:center;
  }
  .wrap{width:min(900px, 100%); padding:28px 20px 120px}
  h1{
    margin:14px 0 6px;
    font-size:clamp(40px, 6.5vw, 80px);
    font-weight:800;
    color:var(--accent);
    letter-spacing:.5px;
  }
  h2{
    margin:0 0 28px;
    font-size:clamp(18px, 3.3vw, 32px);
    color:var(--muted);
    font-weight:700;
  }
  .card{
    margin:0 auto;
    background:#0f1216;
    border:1px solid #1b2026;
    border-radius:18px;
    padding:16px 18px;
    max-width:720px;
    box-shadow:0 10px 32px rgba(0,0,0,.35);
  }
  .row{display:flex; gap:12px; align-items:flex-start; flex-wrap:wrap}
  .pill{padding:6px 10px; border-radius:999px; background:#131820; color:#b7c0ca; font-size:14px}
  #heard,#reply{
    margin-top:14px;
    padding:14px 16px;
    border-radius:14px;
    background:#0d1116;
    border:1px solid #1b2026;
    color:#dfe6ee;
    word-break:break-word;
  }
  #reply{color:#ffd5b1; border-color:#312018; background:linear-gradient(180deg,#15100c,#0d0a07)}
  .hint{margin-top:10px; color:#98a3af; font-size:14px}

  /* --- Przycisk-logo --- */
  .ff-btn{
    position:fixed; left:50%; bottom:24px; transform:translateX(-50%);
    width:168px; height:168px; border-radius:50%;
    border:0; outline:0; cursor:pointer;
    background:#000 center/cover no-repeat url("./file_0000000082cc6243bc1c86d7735f6ad2.png");
    box-shadow:0 10px 34px rgba(255,120,0,.35), inset 0 0 24px rgba(255,120,0,.18);
    transition:transform .15s ease, box-shadow .2s ease, filter .2s ease;
    -webkit-tap-highlight-color:transparent;
  }
  .ff-btn:active{ transform:translateX(-50%) scale(.97) }
  .ff-btn.listening{
    box-shadow:0 12px 50px rgba(255,120,0,.6), inset 0 0 34px rgba(255,120,0,.3);
    filter:saturate(1.08);
  }
  .ff-btn::after{
    content:""; position:absolute; inset:-8px; border-radius:50%;
    border:2px solid rgba(255,140,0,.45); opacity:0; pointer-events:none;
  }
  .ff-btn.listening::after{ animation:ffpulse 1.8s ease-out infinite; opacity:1 }
  @keyframes ffpulse{ from{transform:scale(.9);opacity:.7} to{transform:scale(1.85);opacity:0} }

  .toast{
    position:fixed; top:10px; left:50%; transform:translateX(-50%);
    background:#11161d; color:#e7edf5; border:1px solid #1f2730; border-radius:12px;
    padding:10px 14px; font-size:14px; box-shadow:0 8px 24px rgba(0,0,0,.35);
    max-width:92%; display:none;
  }
  .show{display:block}
</style>
</head>
<body>
  <div class="wrap" aria-live="polite">
    <h1>FreeFlow</h1>
    <h2>Z≈Ç√≥≈º zam√≥wienie</h2>

    <div class="card">
      <div class="row">
        <div class="pill">Powiedz: <b>‚Äûdwie pizze pepperoni‚Äù</b></div>
        <div class="pill">‚Äûzam√≥w taxi na Dworzec‚Äù</div>
        <div class="pill">‚Äûhotel w Krakowie od piƒÖtku na 2 noce‚Äù</div>
      </div>
      <div id="heard">üéôÔ∏è <i>Jeszcze nic nie nagrano.</i></div>
      <div id="reply">üîä <i>Witaj! Kliknij mikrofon na dole i powiedz, czego potrzebujesz.</i></div>
      <div class="hint">Podpowied≈∫: m√≥w wyra≈∫nie. W ha≈Çasie te≈º zadzia≈Ça, ale mo≈ºe potrzebowaƒá powt√≥rki.</div>
    </div>
  </div>

  <button id="mic" class="ff-btn" aria-label="Nagraj / zatrzymaj"></button>
  <div id="toast" class="toast"></div>

<script>
/* ====== UTIL ====== */
const $ = s => document.querySelector(s);
const micBtn = $('#mic');
const heard  = $('#heard');
const reply  = $('#reply');
const toast  = $('#toast');

function showToast(txt){ toast.textContent = txt; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 2000); }

function speak(text){
  try{ speechSynthesis.cancel(); }catch{}
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'pl-PL'; u.rate = 1; u.pitch = 1; u.volume = 1;
  speechSynthesis.speak(u);
}

function deaccent(s){
  const map = {'ƒÖ':'a','ƒá':'c','ƒô':'e','≈Ç':'l','≈Ñ':'n','√≥':'o','≈õ':'s','≈∫':'z','≈º':'z'};
  return s.replace(/[ƒÖƒáƒô≈Ç≈Ñ√≥≈õ≈∫≈º]/g, ch => map[ch] || ch);
}
const norm = s => (' '+deaccent(s.toLowerCase()).replace(/[.,!?]/g,' ')+' ').replace(/\s+/g,' ');

/* liczebniki ‚Üí ilo≈õƒá */
const NUM = {"jeden":1,"jedna":1,"jedno":1,"dwa":2,"dwie":2,"trzy":3,"cztery":4,"piec":5,"szesc":6,"siedem":7,"osiem":8,"dziewiec":9,"dziesiec":10};
function getQty(t){
  const m=t.match(/\b(\d{1,2})\b/); if(m) return +m[1];
  for(const [w,n] of Object.entries(NUM)) if(t.includes(' '+w+' ')) return n;
  if(t.includes(' x2 ')||t.includes(' podwoj')) return 2;
  return 1;
}

/* aliasy jedzenia */
const FOOD_ALIASES = [
  {key:'pizza pepperoni', names:['pizza pepperoni','pizze pepperoni','pizze peperoni','pepperoni','peperoni','pepp','peproni','papperoni']},
  {key:'pizza margherita', names:['pizza margherita','pizze margherita','margherita','margarita']},
  {key:'pizza hawajska',   names:['pizza hawajska','pizze hawajska','hawajska']},
  {key:'pizza',            names:['pizza','pizze','pizzy','pizz']},
  {key:'burger',           names:['burger','hamburger']},
  {key:'cola zero',        names:['cola zero','coca cola zero','kola zero']},
  {key:'cola',             names:['cola','coca cola','kola']},
  {key:'woda',             names:['woda','woda gazowana','woda niegazowana']}
];
function findFood(t){
  for(const item of FOOD_ALIASES){
    for(const name of item.names){
      const n = deaccent(name);
      if(t.includes(' '+n+' ')) return item.key;
      if(t.replace(/\s+/g,'').includes(n.replace(/\s+/g,''))) return item.key;
    }
  }
  return null;
}

const cart = [];
function addToCart(name, qty=1){ cart.push({name,qty}); }

/* ====== INTENT ====== */
function handleIntent(text){
  const t = norm(text);

  // anulowanie
  if(t.includes(' anuluj ') || t.includes(' przerwij ') || t.includes(' stop ')){
    return 'Ok, anulowano.';
  }

  // taxi
  if(t.includes(' taxi ') || t.includes(' taksi ') || t.includes(' kierowc') || t.includes(' przejazd ')){
    return 'Jasne! Podaj skƒÖd i dokƒÖd jedziemy?';
  }

  // hotel
  if(t.includes(' hotel ') || t.includes(' nocleg ') || t.includes(' rezerwacj')){
    return 'Jasne! Powiedz miasto, datƒô przyjazdu i liczbƒô nocy.';
  }

  // zam√≥wienie jedzenia
  if(t.includes(' pizza ') || t.includes(' pizze ') || t.includes(' burger ') || t.includes(' cola ') || t.includes(' woda ') || t.includes(' pepperoni ') || t.includes(' peperoni ')){
    const qty = getQty(t);
    const item = findFood(t) || 'pozycja';
    addToCart(item, qty);
    return `Dodajƒô ${qty} √ó ${item}. Czy dorzuciƒá co≈õ jeszcze?`;
  }

  // pro≈õba o z≈Ço≈ºenie zam√≥wienia
  if(t.includes(' zamow ') || t.includes(' zamowi ') || t.includes(' zlozyc ') ){
    return 'Jasne! Co podaƒá? Pizza, burger czy napoje?';
  }

  // powitanie
  if(t.includes(' dzien dobry ') || t.includes('
