<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FreeFlow</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Pacifico&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0a0d10;
      --panel:#0f1318;
      --muted:#dccfbe;
      --accent:#ff7a1a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:radial-gradient(1200px 900px at 50% -20%, #151a20 0%, var(--bg) 60%);
      color:#fff; font:16px/1.5 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      display:flex; flex-direction:column; align-items:center;
    }
    .wrap{width:min(940px,100%); padding:28px 18px 140px}
    .brand{
      font-family: Pacifico, cursive;
      font-size: clamp(44px, 8.5vw, 96px);
      color: var(--accent);
      letter-spacing:.5px;
      margin: 10px 0 6px;
      text-shadow: 0 6px 22px rgba(255,122,26,.18);
    }
    .subtitle{
      margin:0 0 28px; color:var(--muted);
      font-size: clamp(20px, 3.4vw, 36px); font-weight:800;
    }

    .panel{
      background:linear-gradient(180deg,#0d1116,#0a0e13);
      border:1px solid #1a212a; border-radius:18px;
      padding:18px; max-width:780px; margin: 0 auto 10px;
      box-shadow: 0 10px 34px rgba(0,0,0,.35);
    }
    .pill{display:inline-block; margin:6px 8px 0 0; padding:8px 12px; border-radius:999px;
      background:#121822; color:#b8c2ce; font-size:14px}
    #heard,#reply{
      margin-top:14px; padding:14px 16px; border-radius:14px; border:1px solid #1c232c;
      background:#0a0f14; color:#e8eef6
    }
    #reply{background:linear-gradient(180deg,#15100c,#0d0a07); color:#ffd5b1; border-color:#2d1c12}

    /* === PRZYCISK-LOGO === */
    .ff-btn{
      position:fixed; left:50%; bottom:26px; transform:translateX(-50%);
      width:190px; height:190px; border-radius:50%; border:0; outline:0; cursor:pointer;
      background:#000 center/cover no-repeat url("./file_000000000e9c62469156924aae2c3ff0.png");
      /* je≈õli zmienisz nazwƒô pliku, popraw ≈õcie≈ºkƒô powy≈ºej */
      box-shadow:0 14px 42px rgba(255,120,0,.38), inset 0 0 26px rgba(255,120,0,.2);
      -webkit-tap-highlight-color:transparent;
      transition:transform .15s ease, box-shadow .2s ease, filter .2s ease;
    }
    .ff-btn:active{ transform:translateX(-50%) scale(.97) }
    .ff-btn.listening{
      box-shadow:0 16px 60px rgba(255,120,0,.62), inset 0 0 36px rgba(255,120,0,.3);
      filter:saturate(1.08);
    }
    .ff-btn::after{
      content:""; position:absolute; inset:-10px; border-radius:50%;
      border:2px solid rgba(255,140,0,.45); opacity:0; pointer-events:none;
    }
    .ff-btn.listening::after{ animation:ffpulse 1.9s ease-out infinite; opacity:1 }
    @keyframes ffpulse{ from{transform:scale(.9);opacity:.7} to{transform:scale(1.9);opacity:0} }

    .toast{
      position:fixed; top:10px; left:50%; transform:translateX(-50%);
      background:#11161d; color:#e7edf5; border:1px solid #1f2730; border-radius:12px;
      padding:10px 14px; font-size:14px; box-shadow:0 8px 24px rgba(0,0,0,.35);
      max-width:92%; display:none;
    }
    .show{display:block}
  </style>
</head>
<body>
  <div class="wrap" aria-live="polite">
    <div class="brand">FreeFlow</div>
    <div class="subtitle">Jak mogƒô pom√≥c?</div>

    <div class="panel">
      <div class="pill">Powiedz: <b>‚Äûdwie pizze pepperoni‚Äù</b></div>
      <div class="pill">‚Äûzam√≥w taxi na Dworzec‚Äù</div>
      <div class="pill">‚Äûhotel w Krakowie na 2 noce‚Äù</div>

      <div id="heard">üéôÔ∏è <i>Jeszcze nic nie nagrano.</i></div>
      <div id="reply">üîä <i>Witaj! Kliknij mikrofon na dole i powiedz, czego potrzebujesz.</i></div>
    </div>
  </div>

  <button id="mic" class="ff-btn" aria-label="Nagraj / zatrzymaj"></button>
  <div id="toast" class="toast"></div>

<script>
/* ========== UI helpers ========== */
const $ = s => document.querySelector(s);
const mic = $('#mic'), heard = $('#heard'), reply = $('#reply'), toast = $('#toast');
const showToast = t => { toast.textContent = t; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 1800); };
function speak(t){ try{ speechSynthesis.cancel(); }catch{} const u=new SpeechSynthesisUtterance(t); u.lang='pl-PL'; speechSynthesis.speak(u); }

/* Normalizacja PL */
const repl = {'ƒÖ':'a','ƒá':'c','ƒô':'e','≈Ç':'l','≈Ñ':'n','√≥':'o','≈õ':'s','≈∫':'z','≈º':'z'};
const deaccent = s => s.replace(/[ƒÖƒáƒô≈Ç≈Ñ√≥≈õ≈∫≈º]/g,c=>repl[c]||c);
const norm = s => (' '+deaccent(s.toLowerCase()).replace(/[.,!?]/g,' ')+' ').replace(/\s+/g,' ');

/* liczebniki -> ilo≈õƒá */
const NUM = {"jeden":1,"jedna":1,"jedno":1,"dwa":2,"dwie":2,"trzy":3,"cztery":4,"piec":5,"szesc":6,"siedem":7,"osiem":8,"dziewiec":9,"dziesiec":10};
const qtyFrom = t => { const m=t.match(/\b(\d{1,2})\b/); if(m) return +m[1]; for(const [w,n] of Object.entries(NUM)) if(t.includes(' '+w+' ')) return n; return 1; };

/* aliasy jedzenia */
const FOOD = [
  {key:'pizza pepperoni', names:['pizza pepperoni','pizze pepperoni','pizze peperoni','pepperoni','peperoni','pepp','peproni','papperoni']},
  {key:'pizza margherita', names:['pizza margherita','pizze margherita','margherita','margarita']},
  {key:'pizza hawajska', names:['pizza hawajska','pizze hawajska','hawajska']},
  {key:'pizza', names:['pizza','pizze','pizz']},
  {key:'burger', names:['burger','hamburger']},
  {key:'cola zero', names:['cola zero','coca cola zero','kola zero']},
  {key:'cola', names:['cola','coca cola','kola']},
  {key:'woda', names:['woda','woda gazowana','woda niegazowana']}
];
function findFood(t){
  for(const it of FOOD){
    for(const n of it.names){
      const ne = deaccent(n);
      if(t.includes(' '+ne+' ')) return it.key;
      if(t.replace(/\s+/g,'').includes(ne.replace(/\s+/g,''))) return it.key;
    }
  } return null;
}

/* Prosty router intencji */
function handleIntent(raw){
  const t = norm(raw);
  if(t.includes(' anuluj ')||t.includes(' przerwij ')||t.includes(' stop ')) return 'Ok, anulowano.';

  if(t.includes(' taxi ')||t.includes(' taksi ')||t.includes(' kierowc')||t.includes(' przejazd '))
    return 'Jasne! Podaj skƒÖd i dokƒÖd jedziemy?';

  if(t.includes(' hotel ')||t.includes(' nocleg ')||t.includes(' rezerwacj'))
    return 'Jasne! Powiedz miasto, datƒô przyjazdu i liczbƒô nocy.';

  if(t.includes(' pizza ')||t.includes(' pizze ')||t.includes(' burger ')||t.includes(' cola ')||t.includes(' woda ')||t.includes(' pepperoni ')||t.includes(' peperoni ')){
    const q = qtyFrom(t);
    const item = findFood(t) || 'pozycja';
    return `Dodajƒô ${q} √ó ${item}. Czy dorzuciƒá co≈õ jeszcze?`;
  }

  if(t.includes(' zamow ')||t.includes(' zlozyc ')||t.includes(' zamowi '))
    return 'Jasne! Co podaƒá? Pizza, burger czy napoje?';

  if(t.includes(' dzien dobry ')||t.includes(' czesc ')||t.includes(' hej '))
    return 'Cze≈õƒá! Powiedz, co zamawiamy: dwie pizze pepperoni, taxi czy hotel?';

  return 'Powiedz np. ‚Äûdwie pizze pepperoni‚Äù, ‚Äûzam√≥w taxi na Dworzec‚Äù, albo ‚Äûhotel w Krakowie na 2 noce‚Äù.';
}

/* ========== Rozpoznawanie mowy (Web Speech API) ========== */
let rec=null, active=false;
(function initASR(){
  const R = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!R){ showToast('Brak Web Speech API ‚Äì otw√≥rz w Chrome.'); return; }
  rec = new R();
  rec.lang = 'pl-PL';
  rec.interimResults = true; rec.maxAlternatives = 1;

  rec.onstart = ()=>{ mic.classList.add('listening'); showToast('Nas≈Çuchujƒô‚Ä¶'); };
  rec.onend   = ()=>{ mic.classList.remove('listening'); active=false; };
  rec.onerror = e => { mic.classList.remove('listening'); active=false; showToast('B≈ÇƒÖd: '+e.error); };

  rec.onresult = ev=>{
    let finalText='';
    for(let i=ev.resultIndex;i<ev.results.length;i++){
      const res=ev.results[i], txt=res[0].transcript;
      if(res.isFinal) finalText += txt + ' ';
      else heard.innerHTML = 'üéôÔ∏è (w trakcie) ' + txt;
    }
    finalText=finalText.trim();
    if(finalText){
      heard.innerHTML = 'üó£Ô∏è ' + finalText;
      const ans = handleIntent(finalText);
      reply.innerHTML = 'üîä ' + ans;
      speak(ans);
    }
  };
})();

function toggleMic(){
  if(!rec){ showToast('Twoja przeglƒÖdarka nie wspiera rozpoznawania mowy.'); return; }
  try{ speechSynthesis.cancel(); }catch{}
  if(active){ rec.stop(); active=false; mic.classList.remove('listening'); }
  else      { rec.start(); active=true;  mic.classList.add('listening'); }
}
mic.addEventListener('click', toggleMic);
</script>
</body>
</html>
