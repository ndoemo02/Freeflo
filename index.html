<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8"/>
  <!-- blokada lupy / mobilne DPI / bez ‚Äûauto-zoom‚Äù na inputach -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
  <meta name="color-scheme" content="dark light"/>
  <title>FreeFlow ‚Äî zam√≥w g≈Çosem</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --text:#e9eef6; --muted:#a9b3c3; --brand:#ff7a00; --brand-2:#00c8ff;
      --glass: rgba(0,0,0,.24); --glass-b: rgba(255,255,255,.08);
      --bg:#0b0f14;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font-family: Inter, ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial;
      background: var(--bg) url("assets/Background.png") center/cover fixed no-repeat; /* <- dopasuj je≈õli plik w innej lokalizacji */
      -webkit-text-size-adjust:100%;
    }
    .wrap{max-width:1100px;margin:0 auto;padding:22px 16px}
    header{display:flex;align-items:center;gap:14px;margin-bottom:6px}
    .logo-mini{width:36px;height:36px;border-radius:8px;object-fit:cover;display:block}
    h1{margin:6px 0 12px;font-size:clamp(30px,6vw,52px);line-height:1.05}
    .lead{margin:0 0 10px;color:var(--muted);font-size:clamp(16px,2.7vw,20px)}
    .chips{display:flex;flex-wrap:wrap;gap:12px;margin:10px 0 22px}
    .chip{
      display:inline-flex;align-items:center;gap:10px;
      padding:12px 16px;border-radius:28px;cursor:pointer;
      background:var(--glass);border:1px solid var(--glass-b);backdrop-filter: blur(6px);
      transition: transform .12s ease, background .2s ease, border-color .2s ease;
    }
    .chip:active{transform:scale(.98)}
    .chip .emoji{font-size:18px}
    .chip .label{font-size:16px}
    .hero{display:grid;place-items:center;margin:6px auto 18px}
    .stage{
      width:min(84vw,580px);aspect-ratio:1/1;display:grid;place-items:center;
      background: radial-gradient(120px 120px at 50% 50%, rgba(255,122,0,.12), transparent 60%);
      border-radius:50%;
    }
    .ff-logo{
      width:78%;max-width:520px;display:block;
      filter: drop-shadow(0 0 10px #ff5a00) drop-shadow(0 0 26px rgba(255,153,0,.45));
      transition: transform .2s ease;
    }
    .listening{animation:pulse 1200ms ease-in-out infinite}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}
    .bubble{
      margin:0 auto 12px;max-width:1100px;padding:16px 14px;min-height:48px;
      background:var(--glass);border:1px solid var(--glass-b);border-radius:14px;font-size:18px
    }
    .results{display:none}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .hidden{display:none!important}
    .notice{color:#ffb8a6}
    .toast{
      position:fixed;left:16px;right:16px;bottom:18px;z-index:50;
      padding:12px 14px;border-radius:14px;background:rgba(0,0,0,.65);border:1px solid rgba(255,255,255,.08);
      display:none;font-size:15px
    }
    button{color:inherit}
  </style>
</head>
<body>
  <main class="wrap">
    <header>
      <!-- mini logo (opcjonalne) -->
      <img class="logo-mini" src="assets/Freeflowlogo.png" alt="FreeFlow"/> <!-- <- dopasuj nazwƒô je≈õli inna -->
      <div>
        <div style="font-weight:700;font-size:18px;letter-spacing:.3px">Free <span style="color:var(--brand)">Flow</span></div>
        <div style="font-size:12px;color:var(--muted)">Voice to order ‚Äî tryb testowy, bez profilowania</div>
      </div>
    </header>

    <h1>FreeFlow ‚Äî zam√≥w g≈Çosem</h1>
    <p class="lead">Jedzenie, Taxi albo nocleg ‚Äî powiedz lub kliknij.</p>

    <div class="chips" id="chips">
      <button class="chip" data-type="food"><span class="emoji">üçΩÔ∏è</span><span class="label">Restauracja</span></button>
      <button class="chip" data-type="taxi"><span class="emoji">üöï</span><span class="label">Taxi</span></button>
      <button class="chip" data-type="hotel"><span class="emoji">üè®</span><span class="label">Hotel</span></button>
    </div>

    <section class="hero">
      <div class="stage">
        <!-- LOGO SVG z delikatnym ‚Äûglow‚Äù i klasƒÖ .listening podczas nas≈Çuchu -->
        <img id="ffLogo" class="ff-logo" src="assets/freeflow-logo.svg" alt="FreeFlow logo"/> <!-- <- upewnij siƒô, ≈ºe plik istnieje -->
      </div>
    </section>

    <div id="transcript" class="bubble">Powiedz, co chcesz zam√≥wiƒá‚Ä¶</div>
    <div id="results" class="bubble results"></div>
  </main>

  <div id="toast" class="toast"></div>

  <script>
    /* === KONFIG === */
    const API_BASE = 'https://<twoja-nazwa>.vercel.app'; // <- PODMIE≈É na w≈Ça≈õciwy URL backendu (Vercel)
    const USE_MOCK_IF_FAILS = true; // fallback na czas test√≥w

    /* === UTIL: toast === */
    const toastEl = document.getElementById('toast');
    function toast(msg, ms=2600){
      toastEl.textContent = msg; toastEl.style.display='block';
      clearTimeout(window.__t); window.__t=setTimeout(()=>toastEl.style.display='none', ms);
    }

    /* === UI refs === */
    const logo = document.getElementById('ffLogo');
    const transcript = document.getElementById('transcript');
    const results = document.getElementById('results');

    /* === LOGO animacja === */
    function setListening(on){
      logo.classList.toggle('listening', !!on);
    }

    /* === Web Speech API (Chrome/Edge) === */
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const sr = SpeechRecognition ? new SpeechRecognition() : null;
    if(sr){
      sr.lang = 'pl-PL';
      sr.interimResults = true;
      sr.maxAlternatives = 1;

      sr.onstart = () => setListening(true);
      sr.onend   = () => setListening(false);
      sr.onerror = (e) => { setListening(false); toast('Rozpoznawanie niedostƒôpne: '+e.error); };

      sr.onresult = (ev)=>{
        let finalText = '', interim = '';
        for (let i=ev.resultIndex; i<ev.results.length; i++){
          const t = ev.results[i][0].transcript;
          if(ev.results[i].isFinal) finalText += t + ' ';
          else interim += t;
        }
        transcript.textContent = (finalText || interim || '‚Ä¶').trim();
        if(finalText.trim()){
          handleTranscript(finalText.trim());
        }
      };

      // start nas≈Çuchu na klik logo
      logo.addEventListener('click', ()=>{
        try{ sr.start(); }catch{ /* already running */ }
      });
    } else {
      // brak API ‚Äî klikniƒôcie logo to ‚Äûpr√≥bka‚Äù
      logo.addEventListener('click', ()=>{
        transcript.textContent = 'Zarezerwuj stolik dla trzech os√≥b';
        handleTranscript('Zarezerwuj stolik dla trzech os√≥b');
      });
      toast('W≈ÇƒÖcz Chrome/Edge, by u≈ºyƒá mowy (Web Speech API).');
    }

    /* === Chips (skr√≥towe zam√≥wienia) === */
    document.getElementById('chips').addEventListener('click', (e)=>{
      const chip = e.target.closest('.chip');
      if(!chip) return;
      const type = chip.dataset.type;
      let sample = 'Zarezerwuj stolik dla trzech os√≥b';
      if(type==='taxi') sample='Zam√≥w taks√≥wkƒô na 20:00 do Katowic';
      if(type==='hotel') sample='Zarezerwuj dwa pokoje na dzi≈õ w centrum Krakowa';
      transcript.textContent = sample;
      handleTranscript(sample);
    });

    /* === Call backend === */
    async function callOrder(payload){
      const r = await fetch(`${API_BASE}/api/order`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload),
        mode: 'cors',
      });
      if(!r.ok) throw new Error('API '+r.status);
      return r.json();
    }

    // MOCK na czas test√≥w ‚Äî w≈ÇƒÖcza siƒô tylko, gdy API zwr√≥ci b≈ÇƒÖd i flaga USE_MOCK_IF_FAILS=true
    async function safeOrder(payload){
      try{
        const data = await callOrder(payload);
        return data;
      }catch(err){
        if(!USE_MOCK_IF_FAILS) throw err;
        // Prosty mock:
        await new Promise(res=>setTimeout(res, 500));
        return {
          ok:true,
          echo: payload,
          result: {
            type: inferTypeFromText(payload.text),
            eta: "15‚Äì20 min",
            price: "PLN 38",
            vendor: "Demo Partner",
            note: "Wersja testowa (mock).",
          }
        };
      }
    }

    function inferTypeFromText(text){
      const t = text.toLowerCase();
      if(t.includes('taxi') || t.includes('taks')) return 'taxi';
      if(t.includes('hotel') || t.includes('pok√≥j')) return 'hotel';
      return 'food';
    }

    async function handleTranscript(text){
      results.classList.remove('hidden'); results.style.display='block';
      results.textContent = 'Przetwarzam zam√≥wienie‚Ä¶';
      const payload = { text, locale:'pl-PL' };

      try{
        const data = await safeOrder(payload);
        if(!data || data.ok===false) throw new Error('Brak wyniku');
        const r = data.result || data;
        const lines = [];
        lines.push('‚úÖ Gotowe: ' + (r.type || inferTypeFromText(text)));
        if(r.vendor) lines.push('Miejsce: ' + r.vendor);
        if(r.eta)    lines.push('Czas: ' + r.eta);
        if(r.price)  lines.push('Cena: ' + r.price);
        if(r.note)   lines.push('Info: ' + r.note);
        results.innerHTML = lines.map(l=>`‚Ä¢ ${l}`).join('<br>');
      }catch(e){
        results.innerHTML = `<span class="notice">‚ùå Order b≈ÇƒÖd: ${e.message || e}</span>`;
      }
    }
  </script>
</body>
</html>
