<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>FreeFlow Voice</title>
<style>
  body { font-family: sans-serif; background: #111; color: #fff; text-align: center; }
  #logoBtn { width: 120px; height: 120px; border-radius: 50%; background: #222; border: none; cursor: pointer; margin: 20px auto; display: block; }
  #logoBtn.pulse { animation: pulse 1.5s infinite; }
  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0.7); }
    70% { box-shadow: 0 0 0 15px rgba(0, 255, 0, 0); }
    100% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0); }
  }
  #transcript { margin-top: 10px; min-height: 30px; font-size: 1.2em; }
</style>
</head>
<body>

<h1>ðŸŽ¤ FreeFlow Voice Assistant</h1>

<button id="logoBtn">ðŸŽ¤</button>
<div id="transcript">NaciÅ›nij, aby mÃ³wiÄ‡...</div>

<script>
const API_BASE = "https://twoj-projekt.vercel.app/api/chat";
let recognizing = false;
let recognition;

if ('webkitSpeechRecognition' in window) {
  recognition = new webkitSpeechRecognition();
  recognition.lang = 'pl-PL';
  recognition.interimResults = true;
  recognition.continuous = false;

  recognition.onstart = () => {
    recognizing = true;
    document.getElementById("logoBtn").classList.add("pulse");
    document.getElementById("transcript").innerText = "... sÅ‚ucham ...";
  };

  recognition.onresult = (event) => {
    let finalTranscript = "";
    for (let i = event.resultIndex; i < event.results.length; ++i) {
      const transcript = event.results[i][0].transcript;
      if (event.results[i].isFinal) {
        finalTranscript += transcript;
      } else {
        document.getElementById("transcript").innerText = transcript;
      }
    }
    if (finalTranscript) {
      document.getElementById("transcript").innerText = finalTranscript;
      askAssistant(finalTranscript);
    }
  };

  recognition.onend = () => {
    recognizing = false;
    document.getElementById("logoBtn").classList.remove("pulse");
  };
}

document.getElementById("logoBtn").addEventListener("click", () => {
  if (recognizing) {
    recognition.stop();
    return;
  }
  recognition.start();
});

async function askAssistant(userText) {
  const res = await fetch(API_BASE, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      messages: [{ role: "user", content: userText }],
      system: "JesteÅ› pomocnym asystentem gÅ‚osowym FreeFlow, odpowiadasz krÃ³tko i konkretnie po polsku.",
      temperature: 0.4
    })
  });

  const data = await res.json();
  if (data.success) {
    speak(data.reply);
  } else {
    speak("WystÄ…piÅ‚ bÅ‚Ä…d serwera");
  }
}

function speak(text) {
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "pl-PL";
  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
}
</script>

</body>
</html>
