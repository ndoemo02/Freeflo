<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FreeFlow ‚Ä¢ Voice to order</title>
  <link rel="icon" href="./Freeflow-logo.png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">
  <style>
    :root{
      --text:#e9eef6; --muted:#93a1b4; --brand:#ff7a00; --neon:#00d1ff;
      --panel: rgba(0,0,0,.18); --bdr: rgba(255,255,255,.06);
    }
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--text);
      background: url("./Background.png") center/cover fixed no-repeat #0b0f14;
    }
    .glass{ background: var(--panel); backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
      border:1px solid var(--bdr); border-radius:14px; box-shadow:0 10px 32px rgba(0,0,0,.35), inset 0 0 24px rgba(0,0,0,.25); }

    .topbar{ display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px 16px; position:sticky; top:0; z-index:50;
      background: linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.22), rgba(0,0,0,0));
      backdrop-filter: blur(3px);
    }
    .brand{ display:flex; align-items:center; gap:10px; font-family:'Poppins',sans-serif; font-weight:700; font-size:26px; }
    .brand img{width:36px; height:36px; border-radius:8px}
    .brand .accent{color:var(--brand)}
    .claim{font-size:12px; color:var(--muted); margin-top:-6px}

    .actions{display:flex; gap:10px}
    .iconbtn{ width:44px; height:44px; border-radius:12px; border:1px solid var(--bdr);
      background: var(--panel); color:#cfe2ff; display:grid; place-items:center; cursor:pointer;
      box-shadow: 0 4px 20px rgba(0,0,0,.35); }
    .badge{ position:absolute; margin-top:-28px; margin-left:26px; background:var(--brand); color:#111; font-weight:700; font-size:12px;
      width:22px; height:22px; border-radius:50%; display:grid; place-items:center; box-shadow:0 0 16px #ff7a0033; }

    .menu-wrap{ position:relative; }
    .dropdown{ position:absolute; right:0; top:48px; min-width:240px; display:none;
      background: var(--panel); border:1px solid var(--bdr); border-radius:12px; box-shadow:0 12px 40px rgba(0,0,0,.35); overflow:hidden; z-index:60; }
    .dropdown.open{ display:block; }
    .dd-item{ padding:12px 14px; font-size:15px; display:flex; align-items:center; justify-content:space-between; gap:10px; cursor:pointer; }
    .dd-item:hover{ background: rgba(255,255,255,.06); }
    .dd-sub{ display:none; border-top:1px solid var(--bdr); }
    .dd-item.expand::after{ content:'‚ñ∏'; opacity:.6; }
    .dd-item.expand.open::after{ content:'‚ñæ'; }
    .dd-sub.open{ display:block; }
    .dd-sub .dd-item{ padding-left:22px; }

    .wrap{max-width:980px; margin:0 auto; padding: 10px 16px 64px}
    h1{font-size:42px; line-height:1.05; margin:8px 0 6px}
    .sub{color:var(--muted); margin-bottom:18px}

    .hero{ margin:14px auto 18px; width:min(92vw,640px); aspect-ratio:1/1;
      display:grid; place-items:center; position:relative; background:transparent; border:none; box-shadow:none; }
    .logoBtn{ border:none; background:transparent; padding:0; cursor:pointer; display:grid; place-items:center; }
    .logo{ width:76%; max-width:520px; user-select:none; pointer-events:none;
      filter: drop-shadow(0 0 0px rgba(0,209,255,.0));
      animation: neonPulse 2.2s ease-in-out infinite; }
    @keyframes neonPulse{ 0%{filter:drop-shadow(0 0 0 rgba(0,209,255,0)); transform:scale(1)}
      50%{filter:drop-shadow(0 0 14px rgba(0,209,255,.38)); transform:scale(1.012)}
      100%{filter:drop-shadow(0 0 0 rgba(0,209,255,0)); transform:scale(1)} }

    .bubble{ margin:8px auto 0; max-width:900px; padding:16px 14px; min-height:40px; background: var(--panel);
      border:1px solid var(--bdr); border-radius:14px; color:var(--text); font-size:18px; box-shadow: inset 0 0 24px #0005, 0 8px 40px #000a; }

    .bottom-buttons{ display:flex; flex-wrap:wrap; justify-content:center; gap:12px; margin-top:14px; }
    .bottom-buttons button{ flex:1 1 calc(33.333% - 12px); max-width:180px; min-width:120px; height:56px;
      display:flex; align-items:center; justify-content:center; gap:10px; font-size:18px; border-radius:14px;
      background: var(--panel); color:#e8eefb; border:1px solid var(--bdr); cursor:pointer; box-shadow:0 10px 32px rgba(0,0,0,.35);
      transition: transform .15s ease, background .2s ease; }
    .bottom-buttons button:hover{ transform: translateY(-1px); background: rgba(255,255,255,.22); }
    .bottom-buttons .primary{ outline:2px solid #ff7a00aa; box-shadow:0 0 20px #ff7a0033 inset, 0 10px 32px #000; }

    /* Modal potwierdzenia */
    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:100; }
    .modal.open{ display:flex; }
    .modal .overlay{ position:absolute; inset:0; background:#0008; }
    .modal .card{ position:relative; width:min(92vw,520px); background:var(--panel); border:1px solid var(--bdr); border-radius:16px; padding:16px; z-index:101; }
    .row{ display:flex; align-items:flex-start; gap:8px; margin:6px 0; }
    .row .lbl{ width:110px; color:var(--muted); }
    .btns{ display:flex; gap:10px; justify-content:flex-end; margin-top:14px; }
    .btn{ padding:10px 14px; border-radius:10px; border:1px solid var(--bdr); background:var(--panel); color:var(--text); cursor:pointer; }
    .btn.primary{ background:#ff7a00; color:#111; border-color:#ff7a00; font-weight:700; }
    .note-privacy{ font-size:13px; color:var(--muted); margin-top:8px; }

    @media (max-width:480px){
      h1{font-size:36px}
      .bottom-buttons button{height:52px; font-size:16px; min-width:110px}
    }
  </style>
</head>
<body>

  <header class="topbar">
    <div>
      <div class="brand">
        <img  id="ff-logo" src="./Freeflow-logo.png" alt="logo"/>
        <span class="accent">Free</span>Flow
      </div>
      <div class="claim">Voice to order ‚Äî tryb testowy, bez profilowania</div>
    </div>
    <div class="actions">
      <div class="menu-wrap">
        <button class="iconbtn" id="menuBtn" aria-label="Menu">‚ò∞</button>
        <div id="dropdown" class="dropdown glass">
          <div class="dd-item" id="ordersBtn">Zam√≥wienia</div>
          <div class="dd-item" id="settingsBtn">Ustawienia</div>
          <div class="dd-item" id="helpBtn">Pomoc</div>
          <div class="dd-item" id="privacyBtn">Prywatno≈õƒá</div>
        </div>
      </div>
      <div style="position:relative">
        <button class="iconbtn" id="cartBtn" aria-label="Koszyk">üõí</button>
        <div class="badge" id="cartBadge">0</div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <h1>Z≈Ç√≥≈º zam√≥wienie</h1>
    <div class="sub">Jedzenie, Taxi albo nocleg ‚Äî powiedz lub kliknij.</div>

    <section class="hero">
      <button id="micBtn" type="button" class="logoBtn" aria-label="Naci≈õnij, aby m√≥wiƒá">
        <img class="logo" src="./Freeflow-logo.png" alt="FreeFlow" />
      </button>
    </section>

    <div id="transcript" class="bubble glass">Powiedz: ‚Äûdwie pepperoni na 18:45 bez oliwek‚Äù.</div>

    <div class="bottom-buttons" style="margin-bottom:32px">
      <button class="primary glass" data-quick="Jedzenie">üçΩÔ∏è <span>Jedzenie</span></button>
      <button class="glass" data-quick="Taxi">üöï <span>Taxi</span></button>
      <button class="glass" data-quick="Hotel">üè† <span>Hotel</span></button>
    </div>
  </main>

  <!-- Modal potwierdzenia -->
  <div class="modal" id="confirmModal" aria-hidden="true">
    <div class="overlay" data-close></div>
    <div class="card glass">
      <h3>Potwierd≈∫ zam√≥wienie</h3>
      <div class="row"><div class="lbl">Restauracja</div><div id="m_rest"></div></div>
      <div class="row"><div class="lbl">Pozycje</div><div id="m_items"></div></div>
      <div class="row"><div class="lbl">Czas</div><div id="m_when"></div></div>
      <div class="row"><div class="lbl">Uwagi</div><div id="m_note"></div></div>
      <label style="display:flex; gap:8px; align-items:center; margin-top:8px">
        <input type="checkbox" id="keepData" />
        <span>Zachowaj dane po realizacji (domy≈õlnie: nie)</span>
      </label>
      <div class="note-privacy">FreeFlow nie profiluje Twoich danych. W trybie testowym zam√≥wienie nie trafia do lokalu ‚Äî wysy≈Çamy potwierdzenie do operatora.</div>
      <div class="btns">
        <button class="btn" data-close>Anuluj</button>
        <button class="btn" id="confirmBtn">Potwierd≈∫</button>
      </div>
    </div>
  </div>

  <audio id="ttsPlayer" preload="auto"></audio>

  <script src="./freeflow-assistant.js?v=4"></script>

  <script type="module">
    // Dropdown
    const menuBtn = document.getElementById('menuBtn');
    const dropdown = document.getElementById('dropdown');
    menuBtn.addEventListener('click', (e)=>{ e.stopPropagation(); dropdown.classList.toggle('open'); });
    document.addEventListener('click', (e)=>{
      if (!dropdown.contains(e.target) && e.target !== menuBtn) dropdown.classList.remove('open');
    });

    // Koszyk (prosty localStorage)
    import { addToCart, getCart, cartCount } from './cart.js';
    const badge = document.getElementById('cartBadge');
    function renderBadge(){ badge.textContent = cartCount(); }
    renderBadge();
    window.addEventListener('cart:update', renderBadge);

    document.querySelector('[data-quick="Jedzenie"]').addEventListener('click', ()=> addToCart({type:'food', name:'Zestaw dnia'}));
    document.querySelector('[data-quick="Taxi"]').addEventListener('click',   ()=> addToCart({type:'taxi',  name:'Kurs standard'}));
    document.querySelector('[data-quick="Hotel"]').addEventListener('click',  ()=> addToCart({type:'hotel', name:'Pok√≥j 1 noc'}));

    document.getElementById('cartBtn').addEventListener('click', ()=>{
      const items = getCart();
      alert(items.length ? items.map(i=>`‚Ä¢ ${i.type} ‚Äì ${i.name}`).join('\n') : 'Koszyk jest pusty');
    });

    // Placeholdery
    document.getElementById('ordersBtn').addEventListener('click', ()=> alert('Twoje zam√≥wienia (demo)'));
    document.getElementById('settingsBtn').addEventListener('click',()=> alert('Ustawienia (demo)'));
    document.getElementById('helpBtn').addEventListener('click',    ()=> alert('Pomoc (FAQ, kontakt) ‚Äì demo'));
    document.getElementById('privacyBtn').addEventListener('click', ()=> alert('Prywatno≈õƒá: zero profilowania, dane kasowane po realizacji'));
  </script>
<!-- FF:BUBBLE-START -->
<div id="ff-bubble" aria-live="polite" aria-atomic="true" class="bubble">
  <div id="ff-transcript">Powiedz lub kliknij pozycjƒô z menu‚Ä¶</div>
  <pre id="ff-order" hidden></pre>
</div>
<!-- FF:BUBBLE-END -->
<!-- FF:UI-CSS-START -->
<style id="ff-ui-patch">
  /* Dymek */
  .bubble {
    position: fixed; right: 1rem; top: 6.5rem; z-index: 50;
    padding: .9rem 1rem; border-radius: 1rem; backdrop-filter: blur(10px);
    background: rgba(0,0,0,.45); color:#fff; max-width: min(88vw,520px);
    box-shadow: 0 6px 24px rgba(0,0,0,.25);
  }
  #ff-order { margin:.25rem 0 0; white-space: pre-wrap;
     font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }

  /* Pulsowanie podczas nas≈Çuchu */
  @keyframes ff-pulse {
    from { transform: scale(1);   box-shadow: 0 0 0 0 rgba(255,140,0,.55) }
    to   { transform: scale(1.03); box-shadow: 0 0 20px 12px rgba(255,140,0,0) }
  }
  .listening #ff-logo, .listening #micBtn {
    animation: ff-pulse 900ms ease-in-out infinite alternate;
  }

  /* Tap highlight / zaznaczanie ‚Äì Android */
  * { -webkit-tap-highlight-color: transparent; }
  a, button { outline: none; }
  img, svg { -webkit-user-drag: none; user-select: none; }
  body { -webkit-user-select:none; -ms-user-select:none; user-select:none; }
  input, textarea, [contenteditable="true"] { user-select:text !important; }
</style>
<!-- FF:UI-CSS-END -->
<!-- FF:UI-HELPERS-START -->
<script id="ff-ui-helpers">
  (function(){
    function $(id){ return document.getElementById(id); }
    window._ff = window._ff || {};

    _ff.show = function(text){
      var t = $('ff-transcript'); if (t) t.textContent = text || '';
    };

    _ff.renderOrder = function(r){
      var o = $('ff-order'); if (!o) return;
      if (!r){ o.hidden = true; o.textContent=''; return; }
      var items = (r.items||[]).map(function(i){
        var wo = (i.without && i.without.length) ? (' (bez: ' + i.without.join(', ') + ')') : '';
        return '‚Ä¢ ' + (i.qty || 1) + ' √ó ' + (i.name || 'pozycja') + wo;
      }).join('\n') || '‚Ä¢ (brak pozycji)';
      o.textContent = 'Restauracja: ' + (r.restaurant_name || r.restaurant_id || '‚Äì')
        + '\n' + items + '\nCzas: ' + (r.when || '‚Äì');
      o.hidden = false;
    };
  })();
</script>
<!-- FF:UI-HELPERS-END -->
</body>
</html>
