<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>FreeFlow ‚Äî zam√≥w g≈Çosem</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --fg:#e9eef6; --muted:#a8b3c7; --brand:#ff7a00;
      --glass-bg: rgba(0,0,0,.36); --glass-bd: rgba(255,255,255,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:Inter,sans-serif;color:var(--fg);
      background:#0b0f14 url("assets/Background.png") center/cover fixed no-repeat;
    }
    .ff-header{display:flex;align-items:center;gap:12px;padding:16px;
      background:linear-gradient(180deg,rgba(0,0,0,.5),rgba(0,0,0,0))}
    .ff-title{font-weight:800;font-size:28px}
    .ff-title em{color:var(--brand);font-style:normal}
    .ff-sub{color:var(--muted);font-size:13px}
    .ff-spacer{flex:1}
    .ff-iconBtn{height:44px;width:44px;border-radius:14px;display:grid;place-items:center;
      background:var(--glass-bg);border:1px solid var(--glass-bd);backdrop-filter:blur(8px)}
    h1{margin:8px 16px 6px;font-size:34px}
    .lead{color:#c9d3e3;margin:0 16px 14px}
    .ff-hero{display:grid;place-items:center;margin:6px 0 18px}
    .logo{width:86%;max-width:520px;user-select:none;transition:transform .18s ease,filter .18s ease}
    .logo.listening{animation:ff-pulse 1.15s ease-in-out infinite}
    @keyframes ff-pulse{
      0%{transform:scale(1);filter:drop-shadow(0 0 0 rgba(255,122,0,0))}
      50%{transform:scale(1.05);filter:drop-shadow(0 0 20px rgba(255,122,0,.55))}
      100%{transform:scale(1);filter:drop-shadow(0 0 0 rgba(255,122,0,0))}
    }
    /* transkrypcja ciut ni≈ºej (kropla widoczna) */
    #transcript{position:fixed;left:16px;right:16px;
      bottom:calc(72px + max(16px, env(safe-area-inset-bottom)));
      z-index:40;padding:14px 16px;min-height:48px;color:var(--fg);font-size:16px;
      background:var(--glass-bg);border:1px solid var(--glass-bd);border-radius:16px;backdrop-filter:blur(8px)}
    .ff-bottom{position:fixed;left:16px;right:16px;bottom:max(16px,env(safe-area-inset-bottom));
      display:flex;gap:14px;z-index:30}
    .tile{flex:1;height:72px;border-radius:18px;display:flex;align-items:center;justify-content:center;gap:10px;
      background:var(--glass-bg);border:1px solid var(--glass-bd);backdrop-filter:blur(10px);font-weight:700;color:#fff}
    .tile.active{background:rgba(20,28,38,.46);outline:2px solid rgba(64,171,255,.55);color:#fff}
    .summary{margin:6px 16px 20px;padding:16px;background:var(--glass-bg);
      border:1px solid var(--glass-bd);border-radius:16px;backdrop-filter:blur(8px)}
    .summary h2{margin:0 0 12px;font-size:18px}
    .summary ul{list-style:none;padding:0;margin:0}
    .summary li{margin:6px 0;font-size:15px;display:flex;align-items:center;gap:8px}
    .hint{margin:4px 16px 0;color:#cbd6e6;font-size:13px;opacity:.9}
  </style>
</head>
<body>
  <header class="ff-header">
    <div>
      <div class="ff-title"><em>Free</em> Flow</div>
      <div class="ff-sub">Voice to order ‚Äî tryb testowy, bez profilowania</div>
    </div>
    <div class="ff-spacer"></div>
    <div class="ff-iconBtn" aria-label="Menu">‚â°</div>
    <div class="ff-iconBtn" aria-label="Koszyk">üõí</div>
  </header>

  <main>
    <h1>Z≈Ç√≥≈º zam√≥wienie</h1>
    <p class="lead">Jedzenie, Taxi albo nocleg ‚Äî powiedz lub kliknij.</p>
    <section class="ff-hero">
      <img id="ffLogo" class="logo" src="assets/Freeflowlogo.png" alt="FreeFlow logo"/>
    </section>
    <p class="hint" id="sttHint" style="display:none;">üé§ Rozpoznawanie mowy nie jest wspierane w tej przeglƒÖdarce.</p>
  </main>

  <!-- Transkrypcja (tu pokazujemy to, co s≈Çyszymy) -->
  <div id="transcript">S≈Çucham‚Ä¶</div>

  <!-- Kafelki na dole -->
  <nav class="ff-bottom">
    <button id="btn-food" class="tile active">üçΩÔ∏è Jedzenie</button>
    <button id="btn-taxi" class="tile">üöï Taxi</button>
    <button id="btn-hotel" class="tile">üè° Hotel</button>
  </nav>

  <!-- Podsumowanie (po wyborze) -->
  <div class="summary" id="summaryBox" style="display:none;">
    <h2>Podsumowanie zam√≥wienia</h2>
    <ul id="summaryList"></ul>
  </div>

  <script>
    // ====== elementy ======
    const $logo = document.getElementById('ffLogo');
    const $t = document.getElementById('transcript');
    const $sumBox = document.getElementById('summaryBox');
    const $sumList = document.getElementById('summaryList');
    const $hint = document.getElementById('sttHint');

    // ====== STT (webkitSpeechRecognition) ======
    let recognition = null;
    let isListening = false;

    function sttSupported(){
      return ('webkitSpeechRecognition' in window) || ('SpeechRecognition' in window);
    }

    function initSTT(){
      if(recognition) return;
      const Ctor = window.webkitSpeechRecognition || window.SpeechRecognition;
      if(!Ctor){ $hint.style.display='block'; return; }

      recognition = new Ctor();
      recognition.lang = 'pl-PL';
      recognition.continuous = true;        // stream
      recognition.interimResults = true;     // pokazuj ‚Äûna ≈ºywo‚Äù

      let finalTranscript = '';

      recognition.onstart = () => {
        isListening = true;
        $logo.classList.add('listening');
        finalTranscript = '';
        setTranscript('S≈Çucham‚Ä¶');
      };

      recognition.onresult = (e) => {
        let interim = '';
        for (let i = e.resultIndex; i < e.results.length; i++) {
          const res = e.results[i];
          if (res.isFinal) finalTranscript += res[0].transcript + ' ';
          else interim += res[0].transcript;
        }
        setTranscript((finalTranscript + interim).trim());
      };

      recognition.onerror = (e) => {
        console.warn('STT error:', e.error);
        setTranscript('B≈ÇƒÖd rozpoznawania mowy.');
        stopSTT();
      };

      recognition.onend = () => {
        isListening = false;
        $logo.classList.remove('listening');
        if (!finalTranscript.trim()) setTranscript('Powiedz, co chcesz zam√≥wiƒá‚Ä¶');
      };
    }

    function startSTT(){
      if(!recognition){ initSTT(); }
      if(recognition){
        try{ recognition.start(); }catch(_){}
      }
    }
    function stopSTT(){
      if(recognition){
        try{ recognition.stop(); }catch(_){}
      }
    }

    // ====== TTS (Web Speech API) ======
    function speak(text){
      try{
        if(!("speechSynthesis" in window)) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = "pl-PL"; u.rate=1; u.pitch=1; u.volume=1;
        const assignThenSpeak = () => {
          const voices = speechSynthesis.getVoices() || [];
          const pl = voices.find(v => v.lang?.toLowerCase().startsWith('pl'));
          if(pl) u.voice = pl;
          speechSynthesis.speak(u);
        };
        if (speechSynthesis.getVoices().length) assignThenSpeak();
        else speechSynthesis.onvoiceschanged = assignThenSpeak;
      }catch(e){ console.warn("TTS error:", e); }
    }

    // ====== helpers ======
    function setTranscript(txt){ $t.textContent = txt; }

    function addSummary(items){
      $sumList.innerHTML = "";
      items.forEach(i=>{
        const li = document.createElement('li');
        li.innerHTML = `${i.icon} ${i.text}`;
        $sumList.appendChild(li);
      });
      $sumBox.style.display = "block";
      const plain = items.map(i => i.text).join(". ");
      speak(`Podsumowanie: ${plain}.`);
    }

    // ====== akcje kafelk√≥w ======
    document.getElementById('btn-food').onclick = () => {
      addSummary([
        {icon:"‚úÖ",text:"Status: gotowe"},
        {icon:"üçï",text:"Capricciosa"},
        {icon:"üè®",text:"Miejsce: Demo Partner"},
        {icon:"‚è±",text:"Czas: 15‚Äì20 minut"},
        {icon:"üí≤",text:"Cena: 38 z≈Ç"}
      ]);
    };
    document.getElementById('btn-taxi').onclick = () => {
      addSummary([
        {icon:"‚úÖ",text:"Status: gotowe"},
        {icon:"üöï",text:"Taxi zam√≥wione"},
        {icon:"üìç",text:"Kierunek: Demo City"},
        {icon:"‚è±",text:"Czas podjazdu: oko≈Ço 5 minut"}
      ]);
    };
    document.getElementById('btn-hotel').onclick = () => {
      addSummary([
        {icon:"‚úÖ",text:"Status: gotowe"},
        {icon:"üè°",text:"Hotel Demo"},
        {icon:"‚è±",text:"D≈Çugo≈õƒá pobytu: 2 noce"},
        {icon:"üí≤",text:"Cena: 300 z≈Ç"}
      ]);
    };

    // ====== klik logo: start/stop STT + puls ======
    $logo.onclick = () => {
      if(!sttSupported()){
        $hint.style.display='block';
        $logo.classList.toggle('listening');
        return;
      }
      if(isListening) stopSTT();
      else startSTT();
    };

    // poka≈º informacjƒô, je≈õli STT niedostƒôpne
    if(!sttSupported()) $hint.style.display='block';
  </script>
</body>
</html>
